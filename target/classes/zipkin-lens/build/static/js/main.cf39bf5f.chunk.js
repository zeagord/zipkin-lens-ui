(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{295:function(e,t,a){e.exports=a(714)},511:function(e,t,a){},714:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(16),s=a.n(i),c=a(7),o=a(8),l=a(14),u=a(13),d=a(15),h=a(55),m=a(718),p=a(717),v=a(716),f=a(715),b=function(e){return r.a.createElement("svg",Object.assign({viewBox:"0 0 886 540",fillRule:"evenodd",clipRule:"evenodd"},e),r.a.createElement("g",{transform:"translate(-147.142 -489.518) scale(1.97717)"},r.a.createElement("clipPath",{id:"prefix__a"},r.a.createElement("path",{d:"M297.97 254.996c-24.502.001-44.363 19.862-44.363 44.364.012 18.531 11.545 35.102 28.916 41.556v5.675l5.736 5.741-.659 41.828-149.649-.094c-2.371-.006-4.424-1.733-4.424-1.733-2.243-2.267 1.512-11.638 1.512-11.638l2.829-6.035c1.343-3.006 1.835-3.144 2.619-4.589-3.184.289-4.974.663-7.17 1.245-6.674 1.886-9.977 3.174-17.661 6.622-7.539 3.582-10.666 5.048-15.729 8.266-8.085 4.687-11.907 7.738-18.149 11.599.458.389.939.692 1.44.957 4.978 3.209 8.844 6.069 15.873 10.143 5.063 3.218 8.19 4.684 15.729 8.266 7.684 3.448 10.987 4.736 17.661 6.622 2.196.582 3.986.95 7.17 1.24-.784-1.446-1.276-1.577-2.619-4.584l-2.829-6.035s-3.755-9.371-1.512-11.638c0 0 1.005-.828 2.409-1.339a64.316 64.316 0 0 1 2.486-.394l43.045-.028 107.589.316.405 11.87 1.66 17.523 1.025 11.227 11.958-.005.997-10.929 1.655-17.877.438-11.809 162.516.858 21.271.692a76.26 76.26 0 0 1 13.791 2.43l7.507 2.209c1.497-1.324 2.234-2.494 2.652-3.975.584-1.938.512-4.132.532-5.785-.068-1.565-.056-3.775-.349-5.254-.458-1.442-1.15-2.651-2.647-3.976l-7.507 2.209a70.254 70.254 0 0 1-13.797 2.425l-21.52 1.102H306.358l-.072-41.816 5.741-5.183-.006-6.234c17.573-6.334 30.288-22.993 30.312-41.672 0-24.502-19.862-44.363-44.363-44.363zm-.105 7.945c24.953.414 36.781 20.345 36.568 36.623-.243 18.513-15.845 35.815-36.242 36.436-20.113 0-36.418-16.305-36.418-36.419 0-20.114 15.978-36.64 36.092-36.64z"})),r.a.createElement("g",{clipPath:"url(#prefix__a)"},r.a.createElement("path",{d:"M297.97 254.996c-24.502.001-44.363 19.862-44.363 44.364.012 18.531 11.545 35.102 28.916 41.556v5.675l5.736 5.741-.659 41.828-149.649-.094c-2.371-.006-4.424-1.733-4.424-1.733-2.243-2.267 1.512-11.638 1.512-11.638l2.829-6.035c1.343-3.006 1.835-3.144 2.619-4.589-3.184.289-4.974.663-7.17 1.245-6.674 1.886-9.977 3.174-17.661 6.622-7.539 3.582-10.666 5.048-15.729 8.266-8.085 4.687-11.907 7.738-18.149 11.599.458.389.939.692 1.44.957 4.978 3.209 8.844 6.069 15.873 10.143 5.063 3.218 8.19 4.684 15.729 8.266 7.684 3.448 10.987 4.736 17.661 6.622 2.196.582 3.986.95 7.17 1.24-.784-1.446-1.276-1.577-2.619-4.584l-2.829-6.035s-3.755-9.371-1.512-11.638c0 0 1.005-.828 2.409-1.339a64.316 64.316 0 0 1 2.486-.394l43.045-.028 107.589.316.405 11.87 1.66 17.523 1.025 11.227 11.958-.005.997-10.929 1.655-17.877.438-11.809 162.516.858 21.271.692a76.26 76.26 0 0 1 13.791 2.43l7.507 2.209c1.497-1.324 2.234-2.494 2.652-3.975.584-1.938.512-4.132.532-5.785-.068-1.565-.056-3.775-.349-5.254-.458-1.442-1.15-2.651-2.647-3.976l-7.507 2.209a70.254 70.254 0 0 1-13.797 2.425l-21.52 1.102H306.358l-.072-41.816 5.741-5.183-.006-6.234c17.573-6.334 30.288-22.993 30.312-41.672 0-24.502-19.862-44.363-44.363-44.363zm-.105 7.945c24.953.414 36.781 20.345 36.568 36.623-.243 18.513-15.845 35.815-36.242 36.436-20.113 0-36.418-16.305-36.418-36.419 0-20.114 15.978-36.64 36.092-36.64z",fillOpacity:.997,fillRule:"nonzero"}),r.a.createElement("path",{d:"M297.972 254.995c-24.501 0-44.364 19.863-44.364 44.364a44.365 44.365 0 0 0 28.913 41.558v5.675l5.74 5.739-.663 41.827-149.648-.092c-2.37-.006-4.422-1.735-4.422-1.735-2.243-2.266 1.51-11.638 1.51-11.638l2.83-6.034c1.344-3.006 1.838-3.14 2.62-4.586-3.183.29-4.976.66-7.173 1.242-6.674 1.886-9.973 3.173-17.657 6.621-7.538 3.583-10.668 5.048-15.73 8.266-8.086 4.688-11.91 7.739-18.152 11.599.457.39.942.697 1.443.962 4.978 3.21 8.843 6.066 15.872 10.14 5.063 3.218 8.192 4.685 15.73 8.268 7.685 3.447 10.984 4.735 17.658 6.62 2.196.583 3.99.952 7.173 1.241-.783-1.445-1.277-1.58-2.62-4.586l-2.83-6.032s-3.754-9.374-1.51-11.64c0 0 1.003-.83 2.407-1.342.798-.146 1.641-.27 2.49-.392l43.044-.027 107.588.318.406 11.867 1.66 17.522 1.02 11.228 11.962-.004.993-10.926 1.656-17.879.442-11.808 162.514.854 21.27.697c4.829.403 9.53 1.255 13.795 2.429l7.504 2.208c1.497-1.325 2.23-2.494 2.648-3.974.585-1.939.514-4.13.535-5.784-.069-1.565-.056-3.78-.347-5.259-.458-1.441-1.153-2.65-2.648-3.974l-7.507 2.208a70.334 70.334 0 0 1-13.795 2.428l-21.518 1.104H306.36l-.075-41.82 5.742-5.182-.006-6.233c17.573-6.335 30.29-22.995 30.314-41.674 0-24.502-19.861-44.364-44.363-44.364zm-.107 7.946c24.953.414 36.779 20.348 36.565 36.626-.242 18.513-15.84 35.811-36.237 36.432-20.113 0-36.418-16.305-36.418-36.419 0-20.113 15.976-36.639 36.09-36.639z",fill:"#231f20",fillOpacity:.997,fillRule:"nonzero"}))),r.a.createElement("path",{d:"M147.866 429.886l58.041.217-42.018 75.89 39.618-.034-.22 12.953-61.313.09 41.935-76.314h-36.26l.217-12.802zM268.748 429.777h12.875l-.012 89.252h-12.786l-.077-89.252zM456.838 429.886l12.656-.109-.058 34.693 36.713-34.675 18.36.154-45.098 42.936 45.123 46.092H506.23l-36.902-38.033.099 38.237h-12.591l.002-89.295zM585.25 429.995l12.873-.218v89.135l-12.765.109-.109-89.026zM667.62 426.612l62.835 63.906.597-61.534 12.592.091.109 93.02-63.552-63.79-.075 60.935-12.838-.22.332-92.408zM351.883 429.777c9.382.146 26.512.109 26.512.109 4.575.474 9.325 2.695 13.17 5.568 4.265 3.796 6.768 7.406 7.753 11.611.777 5.807.753 10.648.192 16.205-1.475 5.912-3.741 9.534-7.053 13.145-4.122 3.436-7.614 5-12.678 6.14-4.405.465-10.556.386-15.507.418l.309 36.546h-12.836l.138-89.742zm12.344 40.267l.164-27.42 9.736-.033c5.277.524 8.407 1.78 10.487 4.204 2.117 3.082 2.665 5.018 2.726 8.51.283 2.117-.006 4.887-1.744 8.62-1.518 2.123-1.667 2.746-4.284 4.267-3.077 1.269-1.189 1.038-7.609 1.842l-9.476.01z",fill:"#231f20",stroke:"#231f20",strokeWidth:1.4828775}))},g={browser:{url:"/zipkin",label:"Search",icon:"fa-search"},dependencies:{url:"/zipkin/dependency",label:"Dependencies",icon:"fa-code-branch"}},E=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"renderPageOption",value:function(e){var t=this.props.location,a=g[e].url,n=t.pathname===a;return r.a.createElement("div",{className:"sidebar__page-option".concat(n?"--selected":"")},r.a.createElement(f.a,{to:{pathname:a},className:"sidebar__page-option-link".concat(n?"--selected":"")},r.a.createElement("div",{className:"sidebar__page-option-icon"},r.a.createElement("i",{className:"fas ".concat(g[e].icon)})),r.a.createElement("div",null,g[e].label)))}},{key:"render",value:function(){return r.a.createElement("div",{className:"sidebar"},r.a.createElement("div",{to:{pathname:""},className:"sidebar__brand-link"},r.a.createElement(b,{className:"sidebar__brand-logo"})),r.a.createElement("div",{className:"sidebar__menu"},this.renderPageOption("browser"),this.renderPageOption("dependencies")),r.a.createElement("div",{className:"sidebar__other-links"},r.a.createElement("a",{href:"https://zipkin.apache.org/",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("div",{className:"sidebar__other-link fas fa-home"})),r.a.createElement("a",{href:"https://github.com/openzipkin/zipkin",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("div",{className:"sidebar__other-link fab fa-github"})),r.a.createElement("a",{href:"https://twitter.com/zipkinproject",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("div",{className:"sidebar__other-link fab fa-twitter"})),r.a.createElement("a",{href:"https://gitter.im/openzipkin/zipkin/",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("div",{className:"sidebar__other-link fab fa-gitter"}))))}}]),t}(r.a.Component),C=a(2),y=a(11),k=a.n(y),O=a(29),_=a.n(O),N=a(4),S=a(42),T={onKeyFocus:void 0,onKeyBlur:void 0,onValueFocus:void 0,onValueBlur:void 0},j=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={isKeyFocused:!1,isKeyMenuOpened:!1,isValueFocused:!1},a.nextFocusRef=void 0,a.setNextFocusRef=a.setNextFocusRef.bind(Object(C.a)(Object(C.a)(a))),a.handleKeyFocus=a.handleKeyFocus.bind(Object(C.a)(Object(C.a)(a))),a.handleKeyBlur=a.handleKeyBlur.bind(Object(C.a)(Object(C.a)(a))),a.handleValueFocus=a.handleValueFocus.bind(Object(C.a)(Object(C.a)(a))),a.handleValueBlur=a.handleValueBlur.bind(Object(C.a)(Object(C.a)(a))),a.handleKeyChange=a.handleKeyChange.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"getOptions",value:function(){return this.props.keyOptions.map(function(e){return{value:e.conditionKey,label:e.conditionKey,isDisabled:!e.isAvailable}})}},{key:"getMaxLengthOfKeyOptions",value:function(){var e=this.props.keyOptions,t=0;return e.forEach(function(e){var a=e.conditionKey.length;t<a&&(t=a)}),t}},{key:"setNextFocusRef",value:function(e){this.nextFocusRef=e}},{key:"handleKeyFocus",value:function(){var e=this,t=this.props.onKeyFocus;t&&t(),this.setState({isKeyFocused:!0}),setTimeout(function(){e.setState({isKeyMenuOpened:!0})},30)}},{key:"handleKeyBlur",value:function(){var e=this,t=this.props.onKeyBlur;t&&t(),this.setState({isKeyFocused:!1}),setTimeout(function(){e.setState({isKeyMenuOpened:!1})},30)}},{key:"handleValueFocus",value:function(){var e=this.props.onValueFocus;e&&e(),this.setState({isValueFocused:!0})}},{key:"handleValueBlur",value:function(){var e=this.props.onValueBlur;e&&e(),this.setState({isValueFocused:!1})}},{key:"handleKeyChange",value:function(e){var t=this;(0,this.props.onConditionKeyChange)(e.value),this.nextFocusRef&&setTimeout(function(){t.nextFocusRef.focus()},0)}},{key:"render",value:function(){var e=this.props,t=e.keyString,a=e.children,n=e.onDeleteButtonClick,i=this.state,s=i.isKeyFocused,c=i.isValueFocused,o=i.isKeyMenuOpened,l=this.getMaxLengthOfKeyOptions();return r.a.createElement("div",{className:"search-condition"},r.a.createElement("div",{className:"search-condition__key"},r.a.createElement(S.a,{autoFocus:!0,isSearchable:!1,value:{value:t,label:t},options:this.getOptions(),onFocus:this.handleKeyFocus,onBlur:this.handleKeyBlur,onChange:this.handleKeyChange,styles:{control:function(e){return Object(N.a)({},e,{width:"".concat(s||c?8*l+16:8*t.length+16,"px")})},indicatorsContainer:function(){return{display:"none"}},menuPortal:function(e){return Object(N.a)({},e,{zIndex:9999,width:"".concat(8*l+16,"px")})}},menuPortalTarget:document.body,classNamePrefix:"search-condition-key-select",defaultMenuIsOpen:!0,backspaceRemovesValue:!1,menuIsOpen:o})),r.a.createElement("div",{className:"search-condition__value"},a({onFocus:this.handleValueFocus,onBlur:this.handleValueBlur,setNextFocusRef:this.setNextFocusRef,isFocused:s||c})),r.a.createElement("div",{className:"search-condition__delete-button",role:"presentation",onClick:n},r.a.createElement("span",{className:"fas fa-times search-condition__delete-button-icon"})))}}]),t}(r.a.Component);j.defaultProps=T;var w=j,F=["\u03bcs","ms","s"],R=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={unit:"\u03bcs",isValueFocused:!1,isUnitFocused:!1,isUnitMenuOpened:!1},a.inputRef=void 0,a.unitRef=void 0,a.handleValueFocus=a.handleValueFocus.bind(Object(C.a)(Object(C.a)(a))),a.handleValueBlur=a.handleValueBlur.bind(Object(C.a)(Object(C.a)(a))),a.handleValueKeyDown=a.handleValueKeyDown.bind(Object(C.a)(Object(C.a)(a))),a.handleValueChange=a.handleValueChange.bind(Object(C.a)(Object(C.a)(a))),a.handleUnitFocus=a.handleUnitFocus.bind(Object(C.a)(Object(C.a)(a))),a.handleUnitBlur=a.handleUnitBlur.bind(Object(C.a)(Object(C.a)(a))),a.handleUnitChange=a.handleUnitChange.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"calculateDisplayedValue",value:function(){var e=this.props.value;switch(this.state.unit){case"\u03bcs":return e;case"ms":return e/1e3;case"s":return e/1e6;default:return null}}},{key:"handleValueFocus",value:function(){var e=this.props.onFocus;this.setState({isValueFocused:!0}),e()}},{key:"handleValueBlur",value:function(){var e=this.props.onBlur,t=this.state.isUnitFocused;this.setState({isValueFocused:!1}),t||e()}},{key:"handleUnitFocus",value:function(){var e=this,t=this.props.onFocus;this.setState({isUnitFocused:!0}),t(),setTimeout(function(){e.setState({isUnitMenuOpened:!0})},100)}},{key:"handleUnitBlur",value:function(){var e=this.props.onBlur,t=this.state.isValueFocused;this.setState({isUnitFocused:!1}),t||e(),this.setState({isUnitMenuOpened:!1})}},{key:"handleValueKeyDown",value:function(e){13===e.keyCode&&(this.inputRef.blur(),this.unitRef.focus())}},{key:"handleValueChange",value:function(e){var t=parseInt(e.target.value,10);Number.isNaN(t)&&(t=0);var a=this.props.onConditionChange;switch(this.state.unit){case"\u03bcs":a(String(t));break;case"ms":a(String(1e3*t));break;case"s":a(String(1e3*t*1e3))}}},{key:"handleUnitChange",value:function(e){var t=this.state.unit,a=this.props,n=a.value,r=a.onConditionChange,i=e.value;switch(this.setState({unit:i}),t){case"\u03bcs":switch(i){case"ms":r(String(1e3*n));break;case"s":r(String(1e3*n*1e3))}break;case"ms":switch(i){case"\u03bcs":r(String(n/1e3));break;case"s":r(String(1e3*n))}break;case"s":switch(i){case"\u03bcs":r(String(n/1e6));break;case"ms":r(String(n/1e3))}}}},{key:"render",value:function(){var e=this,t=this.props,a=t.setNextFocusRef,n=t.isFocused,i=this.state,s=i.unit,c=i.isUnitMenuOpened,o=this.calculateDisplayedValue();return r.a.createElement("div",{className:"condition-duration"},r.a.createElement("input",{ref:function(t){a(t),e.inputRef=t},type:"number",value:o,onChange:this.handleValueChange,className:"condition-duration__value-input",style:{width:"".concat(n?76:8*o.length+20,"px")},onFocus:this.handleValueFocus,onBlur:this.handleValueBlur,onKeyDown:this.handleValueKeyDown,min:0}),r.a.createElement(S.a,{ref:function(t){e.unitRef=t},isSearchable:!1,value:{value:s,label:s},options:F.map(function(e){return{value:e,label:e}}),styles:{control:function(e){return Object(N.a)({},e,{width:"38px"})},indicatorsContainer:function(){return{display:"none"}},menuPortal:function(e){return Object(N.a)({},e,{zIndex:9999,width:"38px"})}},menuPortalTarget:document.body,onChange:this.handleUnitChange,classNamePrefix:"condition-duration-unit-select",onFocus:this.handleUnitFocus,onBlur:this.handleUnitBlur,blurInputOnSelect:!0,menuIsOpen:c}))}}]),t}(r.a.Component),L=a(279),I=a.n(L),x=function(e){return"Max ".concat(e)},D=function(e){return e.replace(/Max /,"")},A={btn:{borderStyle:"none",background:"rgba(0,0,0,0)",boxShadow:"none"},wrap:{width:"100%",height:"100%"},input:{width:"100%",height:"100%",background:"rgba(0,0,0,0)"},"input:not(.form-control)":{border:"none",borderRadius:0}},M=function(e){var t=e.limit,a=e.onLimitChange;return r.a.createElement(I.a,{min:0,max:250,value:t,onChange:a,format:x,parse:D,style:A,strict:!0})},B={value:void 0},U=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={isMenuOpened:!1},a.handleFocus=a.handleFocus.bind(Object(C.a)(Object(C.a)(a))),a.handleBlur=a.handleBlur.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"getMaxLengthOfOptions",value:function(){var e=this.props.options,t=4;return e.forEach(function(e){var a=e.length;t<a&&(t=a)}),t}},{key:"getOptions",value:function(){var e=this.props.options,t=[];return e.forEach(function(e){t.push({value:e,label:e})}),t}},{key:"handleFocus",value:function(){var e=this;(0,this.props.onFocus)(),setTimeout(function(){e.setState({isMenuOpened:!0})},100)}},{key:"handleBlur",value:function(){(0,this.props.onBlur)(),this.setState({isMenuOpened:!1})}},{key:"calculateOptimumWidth",value:function(){var e=this.props,t=e.isFocused,a=e.value,n=this.getMaxLengthOfOptions();return t?"".concat(8*n+16,"px"):a?"".concat(8*a.length+16,"px"):"36px"}},{key:"render",value:function(){var e=this,t=this.props,a=t.value,n=t.onConditionChange,i=t.setNextFocusRef,s=t.isLoadingOptions,c=this.state.isMenuOpened,o=this.getOptions(),l=this.getMaxLengthOfOptions();return r.a.createElement("div",{className:"condition-name"},r.a.createElement(S.a,{ref:function(e){i(e)},value:{value:a,label:a},options:o,onFocus:this.handleFocus,onBlur:this.handleBlur,styles:{control:function(t){return Object(N.a)({},t,{width:e.calculateOptimumWidth()})},indicatorsContainer:function(){return{display:"none"}},menuPortal:function(e){return Object(N.a)({},e,{zIndex:9999,width:"".concat(8*l+16,"px")})}},onChange:function(e){n(e.value)},menuPortalTarget:document.body,classNamePrefix:"condition-name-select",blurInputOnSelect:!0,menuIsOpen:c,isLoading:s}))}}]),t}(r.a.Component);U.defaultProps=B;var V=U,K=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).inputRef=void 0,a.handleKeyDown=a.handleKeyDown.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleKeyDown",value:function(e){"Enter"===e.key&&this.inputRef.blur()}},{key:"render",value:function(){var e=this,t=this.props,a=t.value,n=t.onConditionChange,i=t.setNextFocusRef,s=t.onFocus,c=t.onBlur,o=t.isFocused;return r.a.createElement("div",{className:"condition-trace-id"},r.a.createElement("input",{ref:function(t){i(t),e.inputRef=t},type:"text",value:a,onChange:function(e){n(e.target.value)},className:"condition-trace-id__input",style:{width:"".concat(o?144:8*a.length+16,"px")},onFocus:s,onBlur:c,onKeyDown:this.handleKeyDown}))}}]),t}(r.a.Component),P=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).inputRef=void 0,a.handleKeyDown=a.handleKeyDown.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleKeyDown",value:function(e){"Enter"===e.key&&this.inputRef.blur()}},{key:"render",value:function(){var e=this,t=this.props,a=t.value,n=t.onConditionChange,i=t.setNextFocusRef,s=t.onFocus,c=t.onBlur,o=t.isFocused;return r.a.createElement("div",{className:"condition-tags"},r.a.createElement("input",{ref:function(t){i(t),e.inputRef=t},type:"text",value:a,onChange:function(e){n(e.target.value)},className:"condition-tags__input",style:{width:"".concat(o?176:8*a.length+16,"px")},onFocus:s,onBlur:c,onKeyDown:this.handleKeyDown}))}}]),t}(r.a.Component),H=a(292),W=a(280),z=a.n(W),q=a(293),G=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleDateChange=a.handleDateChange.bind(Object(C.a)(Object(C.a)(a))),a.handleTimeChange=a.handleTimeChange.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleDateChange",value:function(e){var t=this.props,a=t.selected;(0,t.onChange)(k()({year:e.year(),month:e.month(),day:e.date(),hour:a.hour(),minute:a.minute(),second:a.second(),millisecond:a.millisecond()}))}},{key:"handleTimeChange",value:function(e){var t=this.props,a=t.selected;(0,t.onChange)(k()({year:a.year(),month:a.month(),day:a.date(),hour:e.hour(),minute:e.minute(),second:e.second(),millisecond:e.millisecond()}))}},{key:"render",value:function(){var e=this.props.selected;return r.a.createElement("div",{className:"date-picker"},r.a.createElement(z.a,{className:"date-picker__calendar",calendar:r.a.createElement(H.a,null),onChange:this.handleDateChange},function(){return r.a.createElement("span",null,r.a.createElement("input",{className:"date-picker__calendar-input",value:e?e.format("MMM Do YY"):"",type:"text",readOnly:!0}))}),r.a.createElement(q.a,{className:"date-picker__timepicker",onChange:this.handleTimeChange,value:e}))}}]),t}(r.a.Component),Q=[{value:"1h",label:"1 Hour"},{value:"2h",label:"2 Hours"},{value:"6h",label:"6 Hours"},{value:"12h",label:"12 Hours"},{value:"1d",label:"1 Day"},{value:"2d",label:"2 Days"},{value:"7d",label:"7 Days"},{value:"custom",label:"Custom"}],Y=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleLookbackChange=a.handleLookbackChange.bind(Object(C.a)(Object(C.a)(a))),a.handleEndTsChange=a.handleEndTsChange.bind(Object(C.a)(Object(C.a)(a))),a.handleStartTsChange=a.handleStartTsChange.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleLookbackChange",value:function(e){var t=this.props,a=t.lookback,n=t.onLookbackChange;switch(e.value){case"custom":n({value:"custom",endTs:a.endTs,startTs:a.endTs});break;default:n({value:e.value,endTs:a.endTs})}}},{key:"handleEndTsChange",value:function(e){var t=this.props,a=t.lookback;(0,t.onLookbackChange)({value:"custom",endTs:e.valueOf(),startTs:a.startTs})}},{key:"handleStartTsChange",value:function(e){var t=this.props,a=t.lookback;(0,t.onLookbackChange)({value:"custom",endTs:a.endTs,startTs:e.valueOf()})}},{key:"render",value:function(){var e=this.props.lookback,t=Q.find(function(t){return t.value===e.value});return r.a.createElement("div",{className:"condition-lookback"},r.a.createElement(S.a,{value:t,options:Q,styles:{control:function(e){return Object(N.a)({},e,{width:"80px"})},indicatorsContainer:function(){return{display:"none"}},menuPortal:function(e){return Object(N.a)({},e,{zIndex:9999,width:"80px"})}},menuPortalTarget:document.body,classNamePrefix:"condition-lookback-select",onChange:this.handleLookbackChange}),"custom"===e.value?r.a.createElement("div",{className:"condition-lookback__custom"},r.a.createElement("div",null,r.a.createElement("div",{className:"condition-lookback__custom-date-picker"},r.a.createElement(G,{selected:k()(e.startTs),onChange:this.handleStartTsChange})),r.a.createElement("div",{className:"condition-lookback__custom-date-picker"},r.a.createElement("div",{className:"condition-lookback__custom-tilda-indicator"},"-"),r.a.createElement(G,{selected:k()(e.endTs),onChange:this.handleEndTsChange})))):null)}}]),t}(r.a.Component),X=a(57),J=function(e){var t={};return Object.keys(e).forEach(function(a){e[a]&&(t[a]=e[a])}),_.a.stringify(t)},Z={"1h":36e5,"2h":72e5,"6h":216e5,"12h":432e5,"1d":864e5,"2d":1728e5,"7d":6048e5},$=function(e){return["serviceName","spanName","minDuration","maxDuration"].concat(Object(X.a)(e),["traceId","tags"])},ee=function(e){switch(e){case"serviceName":case"spanName":case"minDuration":case"maxDuration":case"traceId":case"tags":return!1;default:return!0}},te=function(e){switch(e){case"serviceName":case"spanName":return;case"minDuration":return 10;case"maxDuration":return 100;case"traceId":case"tags":return"";default:return}},ae=function(e,t,a){var n={};t.forEach(function(e){"tags"!==e.key&&(n[e.key]=!0)});for(var r=$(a),i=[],s=0;s<r.length;s+=1){var c=r[s];if(c!==e){var o=!1;n[c]||(o=!0),i.push({conditionKey:c,isAvailable:o})}else i.push({conditionKey:c,isAvailable:!0})}return i},ne=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={isConditionFocused:!1},a.handleAddButtonClick=a.handleAddButtonClick.bind(Object(C.a)(Object(C.a)(a))),a.handleSearchButtonClick=a.handleSearchButtonClick.bind(Object(C.a)(Object(C.a)(a))),a.handleDeleteConditionButtonClick=a.handleDeleteConditionButtonClick.bind(Object(C.a)(Object(C.a)(a))),a.handleConditionKeyChange=a.handleConditionKeyChange.bind(Object(C.a)(Object(C.a)(a))),a.handleConditionValueChange=a.handleConditionValueChange.bind(Object(C.a)(Object(C.a)(a))),a.handleLookbackChange=a.handleLookbackChange.bind(Object(C.a)(Object(C.a)(a))),a.handleLimitChange=a.handleLimitChange.bind(Object(C.a)(Object(C.a)(a))),a.handleKeyDown=a.handleKeyDown.bind(Object(C.a)(Object(C.a)(a))),a.handleConditionFocus=a.handleConditionFocus.bind(Object(C.a)(Object(C.a)(a))),a.handleConditionKeyBlur=a.handleConditionKeyBlur.bind(Object(C.a)(Object(C.a)(a))),a.handleConditionValueBlur=a.handleConditionValueBlur.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown);var e=this.props,t=e.fetchServices,a=e.fetchSpans,n=e.fetchAutocompleteKeys,r=e.location,i=e.addCondition,s=e.setLookbackCondition,c=e.setLimitCondition,o=this.getConditionsFromQueryParameters(),l=o.conditions,u=o.lookbackCondition,d=o.limitCondition;l.forEach(function(e){i(e)}),s({value:u.value||"1h",endTs:u.endTs||k()().valueOf(),startTs:u.startTs||k()().valueOf()}),c(d||10),t();var h=o.conditions.find(function(e){return"serviceName"===e.key});h&&a(h.value),n(),this.fetchTraces(r)}},{key:"componentWillReceiveProps",value:function(e){var t=e.location,a=this.props.location;""!==t.search&&"?"!==t.search&&a.search!==t.search&&this.fetchTraces(t)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"getConditionsFromQueryParameters",value:function(){var e=this.props.location;return""!==e.search&&"?"!==e.search?function(e){var t=[],a={},n=0;return Object.keys(e).forEach(function(r){var i=e[r];switch(r){case"serviceName":case"spanName":t.push({key:r,value:i});break;case"minDuration":case"maxDuration":t.push({key:r,value:parseInt(i,10)});break;case"tags":i.split(" and ").forEach(function(e){t.push({key:"tags",value:e})});break;case"autocompleteTags":i.split(" and ").forEach(function(e){var a=e.split("=");t.push({key:a[0],value:a[1]})});break;case"limit":n=parseInt(i,10);break;case"lookback":switch(i){case"1h":case"2h":case"6h":case"12h":case"1d":case"2d":case"7d":a.value=i,a.endTs=parseInt(e.endTs,10);break;case"custom":a.value=i,a.endTs=parseInt(e.endTs,10),a.startTs=parseInt(e.startTs,10)}}}),{conditions:t,lookbackCondition:a,limitCondition:n}}(_.a.parse(e.search)):{conditions:[],lookbackCondition:{},limitCondition:null}}},{key:"fetchTraces",value:function(e){var t=this.props.fetchTraces;""!==e.search&&"?"!==e.search&&t(function(e){var t,a={};return Object.keys(e).forEach(function(n){var r=e[n];switch(n){case"serviceName":case"spanName":case"minDuration":case"maxDuration":case"limit":a[n]=r;break;case"tags":case"autocompleteTags":t="undefined"===typeof t?r:t.concat(" and ",r);break;case"lookback":switch(r){case"1h":case"2h":case"6h":case"12h":case"1d":case"2d":case"7d":a.endTs=e.endTs,a.lookback=String(Z[r]);break;case"custom":a.endTs=e.endTs,a.lookback=String(parseInt(e.endTs,10)-parseInt(e.startTs,10))}}}),a.annotationQuery=t,a}(_.a.parse(e.search)))}},{key:"handleAddButtonClick",value:function(){var e=this.props,t=e.addCondition,a=function(e,t){var a=$(t),n={};e.forEach(function(e){n[e.key]=!0});for(var r=0;r<a.length;r+=1){var i=a[r];if(!n[i])return i}return"tags"}(e.conditions,e.autocompleteKeys);t({key:a,value:te(a)})}},{key:"handleKeyDown",value:function(e){var t=this.state.isConditionFocused;"Enter"!==e.key||t||this.handleSearchButtonClick()}},{key:"handleSearchButtonClick",value:function(){var e=this.props,t=e.history,a=e.conditions,n=e.lookbackCondition,r=e.limitCondition,i=a.find(function(e){return"traceId"===e.key});if(i)t.push({pathname:"/zipkin/traces/".concat(i.value)});else{var s=function(e,t,a){var n=[],r=[],i={};return e.forEach(function(e){switch(e.key){case"serviceName":case"spanName":case"minDuration":case"maxDuration":i[e.key]=e.value;break;case"traceId":break;case"tags":n.push(e.value);break;default:r.push("".concat(e.key,"=").concat(e.value))}}),i.tags=n.join(" and "),i.autocompleteTags=r.join(" and "),i.limit=a,i.lookback=t.value,i.endTs=t.endTs,"custom"===t.value&&(i.startTs=t.startTs),J(i)}(a,n,r);t.push({pathname:"/zipkin",search:s})}}},{key:"handleConditionKeyChange",value:function(e,t){var a=this.props,n=a.changeConditionKey,r=a.fetchAutocompleteValues;n(e,t),ee(t)&&r(t)}},{key:"handleConditionValueChange",value:function(e,t){var a=this.props,n=a.fetchSpans,r=a.conditions;(0,a.changeConditionValue)(e,t),"serviceName"===r[e].key&&n(t)}},{key:"handleDeleteConditionButtonClick",value:function(e){(0,this.props.deleteCondition)(e)}},{key:"handleLookbackChange",value:function(e){(0,this.props.setLookbackCondition)(e)}},{key:"handleLimitChange",value:function(e){(0,this.props.setLimitCondition)(e)}},{key:"handleConditionFocus",value:function(){this.setState({isConditionFocused:!0})}},{key:"handleConditionKeyBlur",value:function(){this.setState({isConditionFocused:!1})}},{key:"handleConditionValueBlur",value:function(){var e=this;setTimeout(function(){e.setState({isConditionFocused:!1})},0)}},{key:"renderCondition",value:function(e,t,a){var n=this,i=this.props,s=i.services,c=i.spans,o=i.isLoadingServices,l=i.isLoadingSpans,u=i.autocompleteValues,d=i.isLoadingAutocompleteValues,h={value:a,onConditionChange:function(e){n.handleConditionValueChange(t,e)}};switch(e){case"serviceName":case"spanName":var m,p;return"serviceName"===e?(m=s,p=o):(m=c,p=l),function(e){var t=e.onFocus,a=e.onBlur,n=e.setNextFocusRef,i=e.isFocused;return r.a.createElement(V,Object.assign({},h,{options:m,onFocus:t,onBlur:a,setNextFocusRef:n,isFocused:i,isLoadingOptions:p}))};case"minDuration":case"maxDuration":return function(e){var t=e.onFocus,a=e.onBlur,n=e.setNextFocusRef,i=e.isFocused;return r.a.createElement(R,Object.assign({},h,{onFocus:t,onBlur:a,setNextFocusRef:n,isFocused:i}))};case"traceId":return function(e){var t=e.onFocus,a=e.onBlur,n=e.setNextFocusRef,i=e.isFocused;return r.a.createElement(K,Object.assign({},h,{onFocus:t,onBlur:a,setNextFocusRef:n,isFocused:i}))};case"tags":return function(e){var t=e.onFocus,a=e.onBlur,n=e.setNextFocusRef,i=e.isFocused;return r.a.createElement(P,Object.assign({},h,{onFocus:t,onBlur:a,setNextFocusRef:n,isFocused:i}))};default:return function(e){var t=e.onFocus,a=e.onBlur,n=e.setNextFocusRef,i=e.isFocused;return r.a.createElement(V,Object.assign({},h,{options:u,onFocus:t,onBlur:a,setNextFocusRef:n,isFocused:i,isLoadingOptions:d}))}}}},{key:"renderSearchCondition",value:function(e,t){var a=this,n=this.props,i=n.conditions,s=n.autocompleteKeys,c=n.fetchAutocompleteValues,o={keyString:e.key,keyOptions:ae(e.key,i,s),onConditionKeyChange:function(e){a.handleConditionKeyChange(t,e)},onDeleteButtonClick:function(){a.handleDeleteConditionButtonClick(t)}};return ee(e.key)?r.a.createElement(w,Object.assign({},o,{onKeyFocus:function(){c(e.key),a.handleConditionFocus()},onValueFocus:function(){c(e.key),a.handleConditionFocus()},onKeyBlur:this.handleConditionKeyBlur,onValueBlur:this.handleConditionValueBlur}),this.renderCondition(e.key,t,e.value)):r.a.createElement(w,Object.assign({},o,{onKeyFocus:this.handleConditionFocus,onValueFocus:this.handleConditionFocus,onKeyBlur:this.handleConditionKeyBlur,onValueBlur:this.handleConditionValueBlur}),this.renderCondition(e.key,t,e.value))}},{key:"render",value:function(){var e=this,t=this.props,a=t.conditions,n=t.lookbackCondition,i=t.limitCondition;return r.a.createElement("div",{className:"global-search"},r.a.createElement("div",{className:"global-search__conditions"},0===a.length?r.a.createElement("div",{className:"global-search__placeholder"},"Please select the criteria for your trace lookup."):a.map(function(t,a){return r.a.createElement("div",{key:t._id,className:"global-search__search-condition-wrapper"},e.renderSearchCondition(t,a))}),r.a.createElement("div",{role:"presentation",onClick:this.handleAddButtonClick,className:"global-search__add-condition-button"},r.a.createElement("span",{className:"fas fa-plus global-search__add-condition-button-icon"})),r.a.createElement("div",{role:"presentation",onClick:this.handleSearchButtonClick,className:"global-search__find-button"},r.a.createElement("span",{className:"fas fa-search global-search__find-button-icon"}))),r.a.createElement("div",{className:"global-search__condition-limit-wrapper"},r.a.createElement(M,{limit:i,onLimitChange:this.handleLimitChange})),r.a.createElement("div",{className:"global-search__condition-lookback-wrapper"},r.a.createElement(Y,{lookback:n,onLookbackChange:this.handleLookbackChange})))}}]),t}(r.a.Component),re=Object(v.a)(ne),ie=a(27),se=a.n(ie),ce=a(34),oe=Object({NODE_ENV:"production",PUBLIC_URL:""}).API_BASE,le="".concat(oe||"","/zipkin/api/v2"),ue="".concat(le,"/services"),de="".concat(le,"/spans"),he="".concat(le,"/traces"),me="".concat(le,"/trace"),pe="".concat(le,"/dependencies"),ve="".concat(le,"/autocompleteKeys"),fe="".concat(le,"/autocompleteValues"),be=function(e){return{type:"FETCH_SPANS_SUCCESS",spans:e}},ge=function(e){return{type:"FETCH_SERVICES_SUCCESS",services:e}},Ee=function(e){return{type:"FETCH_TRACES_SUCCESS",traces:e}},Ce=function(e){return{type:"FETCH_AUTOCOMPLETE_KEYS_SUCCESS",autocompleteKeys:e}},ye=function(e){return{type:"FETCH_AUTOCOMPLETE_VALUES_SUCCESS",autocompleteValues:e}},ke=Object(h.b)(function(e){return{services:e.services.services,isLoadingServices:e.services.isLoading,spans:e.spans.spans,isLoadingSpans:e.spans.isLoading,conditions:e.globalSearch.conditions,lookbackCondition:e.globalSearch.lookbackCondition,limitCondition:e.globalSearch.limitCondition,autocompleteKeys:e.autocompleteKeys.autocompleteKeys,isLoadingAutocompleteKeys:e.autocompleteKeys.isLoading,autocompleteValues:e.autocompleteValues.autocompleteValues,isLoadingAutocompleteValues:e.autocompleteValues.isLoading}},function(e){return{fetchServices:function(){return e(function(){var e=Object(ce.a)(se.a.mark(function e(t){var a,n;return se.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:"FETCH_SERVICES_REQUEST"}),e.prev=1,e.next=4,fetch(ue);case 4:if((a=e.sent).ok){e.next=7;break}throw Error(a.statusText);case 7:return e.next=9,a.json();case 9:n=e.sent,t(ge(n)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),t({type:"FETCH_SERVICES_FAILURE"});case 16:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t){return e.apply(this,arguments)}}())},fetchSpans:function(t){return e(function(e){return function(){var t=Object(ce.a)(se.a.mark(function t(a){var n,r,i;return se.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a({type:"FETCH_SPANS_REQUEST"}),t.prev=1,n=_.a.stringify({serviceName:e}),t.next=5,fetch("".concat(de,"?").concat(n));case 5:if((r=t.sent).ok){t.next=8;break}throw Error(r.statusText);case 8:return t.next=10,r.json();case 10:i=t.sent,a(be(i)),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),a({type:"FETCH_SPANS_FAILURE"});case 17:case"end":return t.stop()}},t,null,[[1,14]])}));return function(e){return t.apply(this,arguments)}}()}(t))},fetchTraces:function(t){return e(function(e){return function(){var t=Object(ce.a)(se.a.mark(function t(a){var n,r,i;return se.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a({type:"FETCH_TRACES_REQUEST"}),t.prev=1,n=_.a.stringify(e),t.next=5,Promise.all([fetch("".concat(he,"?").concat(n)),new Promise(function(e){return setTimeout(e,500)})]);case 5:if((r=t.sent)[0].ok){t.next=8;break}throw Error(r[0].statusText);case 8:return t.next=10,r[0].json();case 10:i=t.sent,a(Ee(i)),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),a({type:"FETCH_TRACES_FAILURE"});case 17:case"end":return t.stop()}},t,null,[[1,14]])}));return function(e){return t.apply(this,arguments)}}()}(t))},fetchAutocompleteKeys:function(){return e(function(){var e=Object(ce.a)(se.a.mark(function e(t){var a,n;return se.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:"FETCH_AUTOCOMPLETE_KEYS_REQUEST"}),e.prev=1,e.next=4,fetch(ve);case 4:if((a=e.sent).ok){e.next=7;break}throw Error(a.statusText);case 7:return e.next=9,a.json();case 9:n=e.sent,t(Ce(n)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),t({type:"FETCH_AUTOCOMPLETE_KEYS_FAILURE"});case 16:case"end":return e.stop()}},e,null,[[1,13]])}));return function(t){return e.apply(this,arguments)}}())},fetchAutocompleteValues:function(t){return e(function(e){return function(){var t=Object(ce.a)(se.a.mark(function t(a){var n,r,i;return se.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a({type:"FETCH_AUTOCOMPLETE_VALUES_REQUEST"}),t.prev=1,n=_.a.stringify({key:e}),t.next=5,fetch("".concat(fe,"?").concat(n));case 5:if((r=t.sent).ok){t.next=8;break}throw Error(r.statusText);case 8:return t.next=10,r.json();case 10:i=t.sent,a(ye(i)),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),a({type:"FETCH_AUTOCOMPLETE_VALUES_FAILURE"});case 17:case"end":return t.stop()}},t,null,[[1,14]])}));return function(e){return t.apply(this,arguments)}}()}(t))},setLookbackCondition:function(t){return e(function(e){return{type:"GLOBAL_SEARCH_SET_LOOKBACK_CONDITION",lookbackCondition:e}}(t))},setLimitCondition:function(t){return e(function(e){return{type:"GLOBAL_SEARCH_SET_LIMIT_CONDITION",limitCondition:e}}(t))},addCondition:function(t){return e(function(){return{type:"GLOBAL_SEARCH_ADD_CONDITION",condition:arguments.length>0&&void 0!==arguments[0]?arguments[0]:null}}(t))},deleteCondition:function(t){return e(function(e){return{type:"GLOBAL_SEARCH_DELETE_CONDITION",index:e}}(t))},changeConditionKey:function(t,a){e(function(e,t){return{type:"GLOBAL_SEARCH_CHANGE_CONDITION_KEY",index:e,conditionKey:t}}(t,a))},changeConditionValue:function(t,a){e(function(e,t){return{type:"GLOBAL_SEARCH_CHANGE_CONDITION_VALUE",index:e,conditionValue:t}}(t,a))}}})(re),Oe=Object(v.a)(ke),_e=Object(v.a)(function(e){var t=e.location,a=e.children;return r.a.createElement("div",{className:"app__layout"},r.a.createElement(E,{location:t}),r.a.createElement("div",{className:"app__global-search-wrapper"},r.a.createElement(Oe,null)),r.a.createElement("div",{className:"app__content"},a))}),Ne=a(71),Se=a(88),Te=function(e){return 0===e||"undefined"===typeof e?"0ms":e<1e3?"".concat(e,"\u03bc"):e<1e6?"".concat((e/1e3).toFixed(3),"ms"):"".concat((e/1e6).toFixed(3),"s")},je=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={resizingColumnName:null},a.element=void 0,a.handleMouseDown=a.handleMouseDown.bind(Object(C.a)(Object(C.a)(a))),a.handleMouseMove=a.handleMouseMove.bind(Object(C.a)(Object(C.a)(a))),a.handleMouseUp=a.handleMouseUp.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"getPosition",value:function(e){var t=this.element.getBoundingClientRect();return(e-t.left)/t.width}},{key:"handleMouseDown",value:function(e,t){0===e.button&&(this.setState({resizingColumnName:t}),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleMouseUp))}},{key:"handleMouseMove",value:function(e){var t=this.props,a=t.serviceNameColumnWidth,n=t.onServiceNameColumnWidthChange,r=t.onSpanNameColumnWidthChange,i=this.state.resizingColumnName;"SERVICE_NAME_COLUMN"===i?n(Math.max(this.getPosition(e.clientX),.1)):"SPAN_NAME_COLUMN"===i&&r(Math.max(this.getPosition(e.clientX)-a,.075))}},{key:"handleMouseUp",value:function(){window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseUp)}},{key:"renderResizableColumn",value:function(e){var t=this,a=this.props,n=a.serviceNameColumnWidth,i=a.spanNameColumnWidth,s="",c=0;return"SERVICE_NAME_COLUMN"===e?(s="Service Name",c=n):"SPAN_NAME_COLUMN"===e&&(s="Span Name",c=i),r.a.createElement("div",{className:"timeline-header__resizable-column",style:{width:"".concat(100*c,"%")}},r.a.createElement("div",{className:"timeline-header__column-name"},s),r.a.createElement("div",{className:"timeline-header__draggable-splitter",role:"presentation",onMouseDown:function(a){t.handleMouseDown(a,e)}},"||"))}},{key:"renderTimeMarkers",value:function(){for(var e=this.props,t=e.startTs,a=e.endTs,n=e.numTimeMarkers,i=e.serviceNameColumnWidth,s=e.spanNameColumnWidth,c=[],o=0;o<n;o+=1){var l=t+o/(n-1)*(a-t),u=o/(n-1),d="";u<=0?d="--first":u>=1&&(d="last"),c.push(r.a.createElement("div",{key:u,className:"timeline-header__time-marker timeline-header__time-marker".concat(d),style:{left:"".concat(100*u,"%")}},r.a.createElement("span",{className:"timeline-header__time-marker-label timeline-header__time-marker-label".concat(d)},Te(l))))}return r.a.createElement("div",{className:"timeline-header__time-markers",style:{width:"".concat(100*(1-(i+s)),"%")}},c)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"timeline-header",ref:function(t){e.element=t}},this.renderResizableColumn("SERVICE_NAME_COLUMN"),this.renderResizableColumn("SPAN_NAME_COLUMN"),this.renderTimeMarkers())}}]),t}(r.a.Component),we=a(198),Fe=function(e){switch(e){case"transient":case"critical":return"#da8b8b";default:return"#9bbdda"}},Re=function(e){switch(e.length%10){case 0:return"#00ACED";case 1:return"#5AE628";case 2:return"#CD201F";case 3:return"#D1AD59";case 4:return"#FF5A60";case 5:return"#563D7C";case 6:return"#00B489";case 7:return"#F8630E";case 8:return"#FF5700";default:return"#111111"}},Le=function(e){var t=e.serviceName,a=e.count,n=e.className,i={backgroundColor:Re(t)},s=a?"".concat(t," x ").concat(a):t;return r.a.createElement("span",{style:i,className:"service-name-badge ".concat(n)},s)};Le.defaultProps={count:null,className:""};var Ie=Le,xe=a(1),De=a.n(xe),Ae=De.a.shape({key:De.a.string.isRequired,value:De.a.string.isRequired}),Me=De.a.arrayOf(Ae),Be=De.a.shape({value:De.a.string.isRequired,timestamp:De.a.number.isRequired,endpoint:De.a.string.isRequired,relativeTime:De.a.string.isRequired}),Ue=De.a.arrayOf(Be),Ve=De.a.shape({spanId:De.a.string.isRequired,spanName:De.a.string.isRequired,parentId:De.a.string,childIds:De.a.arrayOf(De.a.string).isRequired,serviceName:De.a.string.isRequired,serviceNames:De.a.arrayOf(De.a.string).isRequired,timestamp:De.a.number.isRequired,duration:De.a.number.isRequired,durationStr:De.a.string.isRequired,tags:Me.isRequired,annotations:Ue.isRequired,errorType:De.a.string.isRequired,depth:De.a.number.isRequired,width:De.a.number.isRequired,left:De.a.number.isRequired}),Ke=De.a.arrayOf(Ve),Pe=De.a.shape({serviceName:De.a.string.isRequired,spanCount:De.a.number.isRequired}),He=De.a.arrayOf(Pe),We=De.a.shape({traceId:De.a.string.isRequired,timestamp:De.a.number.isRequired,duration:De.a.number.isRequired,durationStr:De.a.string.isRequired,servicePercentage:De.a.number,serviceSummaries:He.isRequired,infoClass:De.a.string,spanCount:De.a.number.isRequired,width:De.a.number.isRequired}),ze=(De.a.arrayOf(We),De.a.shape({traceId:De.a.string.isRequired,spans:Ke.isRequired,serviceNameAndSpanCounts:He.isRequired,duration:De.a.number.isRequired,durationStr:De.a.string.isRequired}),function(e){var t=e.span,a=e.serviceNameColumnWidth;return r.a.createElement("div",{className:"timeline-span-data"},r.a.createElement("div",{className:"timeline-span-data__left-container",style:{width:"".concat(100*a,"%")}},r.a.createElement("span",{className:"timeline-span-data__depth-marker",style:{left:"".concat(14*t.depth,"px"),background:"".concat(Re(t.serviceName))}})),r.a.createElement("div",{className:"timeline-span-data__right-container",style:{left:"".concat(100*a,"%"),width:"".concat(100*(1-a),"%")}},function(e){return r.a.createElement("div",{className:"timeline-span-data__content"},r.a.createElement("div",{className:"timeline-span-data__title",style:{borderColor:Re(e.serviceName)}},"".concat(e.serviceName,": ").concat(e.spanName)),r.a.createElement("div",{className:"timeline-span-data__aka-badges"},e.serviceNames?e.serviceNames.map(function(e){return r.a.createElement(Ie,{key:e,serviceName:e,className:"timeline-span-data__aka-badge"})}):null),r.a.createElement(we.a,{showPagination:!1,minRows:0,data:e.annotations.map(function(e){return{duration:k()(e.timestamp/1e3).format("MM/DD HH:mm:ss:SSS"),relativeTime:e.relativeTime,annotation:e.value,address:e.endpoint}}),columns:[{Header:"Date Time",accessor:"duration"},{Header:"Relative Time",accessor:"relativeTime"},{Header:"Annotation",accessor:"annotation"},{Header:"Address",accessor:"address"}]}),r.a.createElement(we.a,{showPagination:!1,minRows:0,data:e.tags,columns:[{Header:"Key",accessor:"key"},{Header:"Value",accessor:"value"}]}))}(t)))}),qe=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleChildrenOpenToggle=a.handleChildrenOpenToggle.bind(Object(C.a)(Object(C.a)(a))),a.handleDataOpenToggle=a.handleDataOpenToggle.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"calculateLeftAndWidth",value:function(e,t){var a,n,r=this.props,i=r.startTs,s=r.endTs,c=r.traceDuration,o=e*c/100,l=o+t*c/100,u=s-i;return o<i&&l<i?(a=0,n=0):o>=s?(a=100,n=0):o<i&&l>i&&l<s?(a=0,n=(l-i)/u*100):o<i&&l>i&&l>s?(a=0,n=100):o>=i&&o<s&&l<=s?(a=(o-i)/u*100,n=(l-o)/u*100):o>=i&&o<s&&l>s?(a=(o-i)/u*100,n=(s-o)/u*100):(a=0,n=0),{left:a,width:n}}},{key:"calculateBaseWidth",value:function(e,t){return(e-t)/this.props.traceDuration*100}},{key:"calculateBaseLeft",value:function(e){var t=this.props,a=t.traceDuration;return(e-t.traceTimestamp)/a*100}},{key:"handleChildrenOpenToggle",value:function(e){var t=this.props,a=t.span;(0,t.onChildrenOpenToggle)(a.spanId),e.stopPropagation()}},{key:"handleDataOpenToggle",value:function(){var e=this.props,t=e.span;(0,e.onDataOpenToggle)(t.spanId)}},{key:"renderServiceNameColumn",value:function(){var e=this.props,t=e.span,a=e.hasChildren,n=e.areChildrenOpened;return r.a.createElement("div",{className:"timeline-span__service-name-column"},a?r.a.createElement("div",{className:"timeline-span__open-toggle-button",style:{left:"".concat(14*(t.depth-1),"px")},onClick:this.handleChildrenOpenToggle,role:"presentation"},n?r.a.createElement("span",{className:"fas fa-minus-square"}):r.a.createElement("span",{className:"fas fa-plus-square"})):null,r.a.createElement("span",{className:"timeline-span__depth-marker",style:{left:"".concat(14*t.depth,"px"),background:"".concat(Re(t.serviceName))}}),r.a.createElement("div",{className:"timeline-span__service-name-wrapper",style:{left:"".concat(14*(t.depth+1),"px")}},r.a.createElement("div",{className:"timeline-span__service-name"},t.serviceName)))}},{key:"renderTimeMarkers",value:function(){for(var e=this.props.numTimeMarkers,t=[],a=1;a<e-1;a+=1){var n=a/(e-1);t.push(r.a.createElement("span",{key:n,className:"timeline-span__time-marker",style:{left:"".concat(100*n,"%")}}))}return t}},{key:"renderSpanDuration",value:function(e,t){var a=this.props.span;return parseInt(e,10)>50?r.a.createElement("span",{className:"timeline-span__duration timeline-span__duration--right",style:{right:"".concat(100-(e+t),"%")}},a.durationStr):r.a.createElement("span",{className:"timeline-span__duration timeline-span__duration--left",style:{left:"".concat(e,"%")}},a.durationStr)}},{key:"renderSpanBar",value:function(){var e=this.props.span,t=e.annotations,a=t.find(function(e){return"Client Start"===e.value}),n=t.find(function(e){return"Server Start"===e.value}),i=t.find(function(e){return"Client Finish"===e.value}),s=t.find(function(e){return"Server Finish"===e.value});if(a&&n&&i&&s){var c=this.calculateBaseWidth(i.timestamp,a.timestamp),o=this.calculateBaseWidth(s.timestamp,n.timestamp),l=this.calculateBaseLeft(a.timestamp),u=this.calculateBaseLeft(n.timestamp),d=this.calculateLeftAndWidth(l,c),h=d.left,m=d.width,p=this.calculateLeftAndWidth(u,o),v=p.left,f=p.width;return r.a.createElement("div",{className:"timeline-span__bar-container"},r.a.createElement("span",{className:"timeline-span__bar timeline-span__bar--client",style:{left:"".concat(h,"%"),width:"".concat(m,"%")}}),r.a.createElement("span",{className:"timeline-span__bar timeline-span__bar--server",style:{left:"".concat(v,"%"),width:"".concat(f,"%"),background:"".concat(Fe(e.errorType))}}),this.renderSpanDuration(h,m))}var b=this.calculateLeftAndWidth(e.left,e.width),g=b.left,E=b.width;return r.a.createElement("div",{className:"timeline-span__bar-container"},r.a.createElement("span",{className:"timeline-span__bar",style:{left:"".concat(g,"%"),width:"".concat(E,"%"),background:"".concat(Fe(e.errorType))}}),this.renderSpanDuration(g,E))}},{key:"render",value:function(){var e=this.props,t=e.span,a=e.serviceNameColumnWidth,n=e.spanNameColumnWidth,i=e.areDataOpened;return r.a.createElement("div",null,r.a.createElement("div",{role:"presentation",className:"timeline-span",onClick:this.handleDataOpenToggle},r.a.createElement("div",{className:"timeline-span__service-name-column-wrapper",style:{width:"".concat(100*a,"%")}},this.renderServiceNameColumn()),r.a.createElement("div",{className:"timeline-span__span-name-column-wrapper",style:{width:"".concat(100*n,"%")}},r.a.createElement("div",{className:"timeline-span__span-name-column"},t.spanName)),r.a.createElement("div",{className:"timeline-span__bar-wrapper",style:{width:"".concat(100*(1-(a+n)),"%")}},this.renderTimeMarkers(),this.renderSpanBar())),i?r.a.createElement(ze,{span:t,serviceNameColumnWidth:a}):null)}}]),t}(r.a.Component),Ge=.2,Qe=.1,Ye=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={serviceNameColumnWidth:Ge,spanNameColumnWidth:Qe,childrenClosedSpans:{},dataOpenedSpans:{}},a.handleServiceNameColumnWidthChange=a.handleServiceNameColumnWidthChange.bind(Object(C.a)(Object(C.a)(a))),a.handleSpanNameColumnWidthChange=a.handleSpanNameColumnWidthChange.bind(Object(C.a)(Object(C.a)(a))),a.handleChildrenOpenToggle=a.handleChildrenOpenToggle.bind(Object(C.a)(Object(C.a)(a))),a.handleDataOpenToggle=a.handleDataOpenToggle.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleServiceNameColumnWidthChange",value:function(e){this.setState({serviceNameColumnWidth:e})}},{key:"handleSpanNameColumnWidthChange",value:function(e){this.setState({spanNameColumnWidth:e})}},{key:"handleChildrenOpenToggle",value:function(e){var t=this.state.childrenClosedSpans,a={};a=t[e]?Object(N.a)({},t,Object(Se.a)({},e,void 0)):Object(N.a)({},t,Object(Se.a)({},e,!0)),this.setState({childrenClosedSpans:a})}},{key:"handleDataOpenToggle",value:function(e){var t=this.state.dataOpenedSpans,a={};a=t[e]?Object(N.a)({},t,Object(Se.a)({},e,!1)):Object(N.a)({},t,Object(Se.a)({},e,!0)),this.setState({dataOpenedSpans:a})}},{key:"render",value:function(){for(var e=this,t=this.props,a=t.startTs,n=t.endTs,i=t.traceSummary,s=this.state,c=s.serviceNameColumnWidth,o=s.spanNameColumnWidth,l=s.childrenClosedSpans,u=s.dataOpenedSpans,d={},h=0;h<i.spans.length;h+=1)l[i.spans[h].parentId]&&(d[i.spans[h].spanId]=!0);return r.a.createElement("div",{className:"timeline"},r.a.createElement(je,{startTs:a,endTs:n,serviceNameColumnWidth:c,spanNameColumnWidth:o,numTimeMarkers:5,onServiceNameColumnWidthChange:this.handleServiceNameColumnChange,onSpanNameColumnWidthChange:this.handleSpanNameColumnChange}),i.spans.map(function(t,s,h){var m=!1;if(s<h.length-1&&h[s+1].depth>t.depth&&(m=!0),d[t.spanId]){if(m)for(var p=0;p<t.childIds.length;p+=1)d[t.childIds[p]]=!0;return null}return r.a.createElement(qe,{key:t.spanId,startTs:a,endTs:n,traceDuration:i.duration,traceTimestamp:i.spans[0].timestamp,numTimeMarkers:5,serviceNameColumnWidth:c,spanNameColumnWidth:o,span:t,hasChildren:m,areChildrenOpened:!l[t.spanId],areDataOpened:!!u[t.spanId],onChildrenOpenToggle:e.handleChildrenOpenToggle,onDataOpenToggle:e.handleDataOpenToggle})}))}}]),t}(r.a.Component),Xe=a(43),Je=a.n(Xe);function Ze(e){if(e.length>16){var t=e.padStart(32,"0");return t.startsWith("0000000000000000")?t.substring(16):t}return e.padStart(16,"0")}function $e(e){return e&&Object.keys(e).length>0}function et(e,t){var a={traceId:t.traceId.length>16?t.traceId:e.traceId},n=e.parentId||t.parentId;n&&(a.parentId=n),a.id=e.id;var r=e.name||t.name;r&&(a.name=r);var i=e.kind||t.kind;i&&(a.kind=i);var s=e.timestamp||t.timestamp;s&&(a.timestamp=s);var c=e.duration||t.duration;c&&(a.duration=c);var o=Object.assign({},e.localEndpoint,t.localEndpoint);$e(o)&&(a.localEndpoint=o);var l=Object.assign({},e.remoteEndpoint,t.remoteEndpoint);return $e(l)&&(a.remoteEndpoint=l),0===e.annotations.length?a.annotations=t.annotations:0===t.annotations.length?a.annotations=e.annotations:a.annotations=Je()(Je.a.unionWith(e.annotations,t.annotations,Je.a.isEqual)).sortBy("timestamp","value").value(),a.tags=Object.assign({},e.tags,t.tags),(e.debug||t.debug)&&(a.debug=!0),(e.shared||t.shared)&&(a.shared=!0),a}function tt(e,t){return e||t?e?t?(e>t)-(e<t):1:-1:0}function at(e){return"undefined"===typeof e}function nt(e,t){var a=at(e.shared)||!e.shared,n=at(t.shared)||!t.shared;return a&&n?"CLIENT"===e.kind?-1:1:a?-1:n?1:0}function rt(e,t){var a=tt(e.id,t.id);if(0!==a)return a;var n=nt(e,t);return 0!==n?n:function(e,t){if(at(e))return-1;if(at(t))return 1;var a=tt(e.serviceName,t.serviceName);if(0!==a)return a;var n=tt(e.ipv4,t.ipv4);return 0!==n?n:tt(e.ipv6,t.ipv6)}(e.localEndpoint,t.localEndpoint)}function it(e,t){return!e.parentId&&t.parentId?-1:e.parentId&&!t.parentId?1:e.id===t.id?nt(e,t):tt(e.timestamp,t.timestamp)||tt(e.name,t.name)}function st(e){var t=e.length;if(0===t)return e;var a,n,r,i,s=[];if(e.forEach(function(e){var t=function(e){var t={traceId:Ze(e.traceId)},a=e.id.padStart(16,"0");if(e.parentId){var n=e.parentId.padStart(16,"0");n!==a&&(t.parentId=n)}return t.id=a,e.name&&""!==e.name&&"unknown"!==e.name&&(t.name=e.name),e.kind&&(t.kind=e.kind),e.timestamp&&(t.timestamp=e.timestamp),e.duration&&(t.duration=e.duration),$e(e.localEndpoint)&&(t.localEndpoint=Object.assign({},e.localEndpoint)),$e(e.remoteEndpoint)&&(t.remoteEndpoint=Object.assign({},e.remoteEndpoint)),t.annotations=e.annotations?e.annotations.slice(0):[],t.annotations.length>1&&(t.annotations=Je()(Je.a.unionWith(t.annotations,Je.a.isEqual)).sortBy("timestamp","value").value()),t.tags=e.tags||{},e.debug&&(t.debug=!0),e.shared&&"CLIENT"!==e.kind&&(t.shared=!0),t}(e);a&&32===a.length||(a=t.traceId),s.push(t)}),t<=1)return s;s.sort(rt);for(var c=0;c<t;c+=1){var o=s[c];o.traceId.length!==a.length&&(o.traceId=a);for(var l=o.localEndpoint?Object.assign({},o.localEndpoint):{};c+1<t;){var u=s[c+1];if(u.id!==o.id)break;if(o.shared!==u.shared||(r=l,(i=u.localEndpoint)&&(r.serviceName&&i.serviceName&&r.serviceName!==i.serviceName||r.ipv4&&i.ipv4&&r.ipv4!==i.ipv4||r.ipv6&&i.ipv6&&r.ipv6!==i.ipv6||r.port&&i.port&&r.port!==i.port||(r.serviceName||(r.serviceName=i.serviceName),r.ipv4||(r.ipv4=i.ipv4),r.ipv6||(r.ipv6=i.ipv6),r.port||(r.port=i.portAsInt),0))))break;o=et(o,u),t-=1,s.splice(c+1,1)}n&&n.id===o.id&&("CLIENT"!==n.kind||"SERVER"!==o.kind||o.shared||(o.shared=!0),o.shared&&!o.parentId&&n.parentId&&(o.parentId=n.parentId)),n=o,s[c]=o}return s.sort(it)}var ct=function(){function e(t){Object(c.a)(this,e),this._parent=void 0,this._span=t,this._children=[]}return Object(o.a)(e,[{key:"_setParent",value:function(e){this._parent=e}},{key:"setSpan",value:function(e){if(!e)throw new Error("span was undefined");this._span=e}},{key:"addChild",value:function(e){if(!e)throw new Error("child was undefined");if(e===this)throw new Error("circular dependency on ".concat(this.toString()));e._setParent(this),this._children.push(e)}},{key:"queueRootMostSpans",value:function(){var e=[];if("undefined"===typeof this.span?this.children.forEach(function(t){return e.push(t)}):e.push(this),0===e.length)throw new Error("Trace was empty");return e}},{key:"traverse",value:function(e){for(var t=this.queueRootMostSpans();t.length>0;){var a=t.shift();e(a.span);for(var n=a.children,r=0;r<n.length;r+=1)t.push(n[r])}}},{key:"toString",value:function(){return this._span?"SpanNode(".concat(JSON.stringify(this._span),")"):"SpanNode()"}},{key:"parent",get:function(){return this._parent}},{key:"span",get:function(){return this._span}},{key:"children",get:function(){return this._children}}]),e}();function ot(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;if(!t)return e;var n=a?JSON.stringify(a):"x";return"".concat(e,"-").concat(n)}function lt(e,t){return tt(e.span.timestamp,t.span.timestamp)}var ut=function(){function e(t){Object(c.a)(this,e);var a=t.debug,n=void 0!==a&&a;this._debug=n,this._rootSpan=void 0,this._keyToNode={},this._spanToParent={}}return Object(o.a)(e,[{key:"_index",value:function(e){var t,a;e.shared?(t=ot(e.id,!0,e.localEndpoint),a=e.id):(t=e.id,a=e.parentId),this._spanToParent[t]=a}},{key:"_process",value:function(e){var t,a=e.localEndpoint,n=ot(e.id,e.shared,e.localEndpoint),r=a?ot(e.id,e.shared):n;if(e.shared)t=e.id;else if(e.parentId)t=ot(e.parentId,!0,a),this._spanToParent[t]?this._spanToParent[r]=t:t=e.parentId;else if(this._rootSpan&&this._debug){console.log("".concat("attributing span missing parent to root",": traceId=").concat(e.traceId,", rootId=").concat(this._rootSpan.span.id,", id=").concat(e.id))}var i=new ct(e);t||this._rootSpan?e.shared?(this._keyToNode[n]=i,this._keyToNode[r]=i):this._keyToNode[r]=i:(this._rootSpan=i,delete this._spanToParent[r])}},{key:"build",value:function(e){var t=this;if(0===e.length)throw new Error("Trace was empty");var a=st(e),n=a.length,r=Object(Ne.a)(a,1)[0].traceId;this._debug&&console.log("building trace tree: traceId=".concat(r));for(var i=0;i<n;i+=1)this._index(a[i]);for(var s=0;s<n;s+=1)this._process(a[s]);return this._rootSpan||(this._debug&&console.log("substituting dummy node for missing root span: traceId=".concat(r)),this._rootSpan=new ct),Object.keys(this._spanToParent).forEach(function(e){var a=t._keyToNode[e],n=t._keyToNode[t._spanToParent[e]];n?n.addChild(a):t._rootSpan.addChild(a)}),function(e){var t,a=[];for(a.push(e);a.length>0;){var n=a.shift();(t=n).children.length>0&&t.children.sort(lt);for(var r=n.children,i=0;i<r.length;i+=1)a.push(r[i])}}(this._rootSpan),this._rootSpan}}]),e}(),dt=function(){function e(t){Object(c.a)(this,e);var a=t.endpoint,n=t.skew;this._endpoint=a,this._skew=n}return Object(o.a)(e,[{key:"endpoint",get:function(){return this._endpoint}},{key:"skew",get:function(){return this._skew}}]),e}();function ht(e,t){return!(!e||!t)&&(!(!e.ipv6||!t.ipv6||e.ipv6!==t.ipv6)||!(!e.ipv4&&!t.ipv4)&&e.ipv4===t.ipv4)}function mt(e,t){if(!ht(t.endpoint,e.localEndpoint))return e;var a=Object.assign({},e);e.timestamp&&(a.timestamp=e.timestamp-t.skew);var n=e.annotations.length;n>0&&(a.annotations=[]);for(var r=0;r<n;r+=1){var i=e.annotations[r];a.annotations[r]={timestamp:i.timestamp-t.skew,value:i.value}}return a}function pt(e,t){t&&e.setSpan(mt(e.span,t));var a=function(e){var t=e.parent?e.parent.span:void 0,a=e.span;if(t&&"CLIENT"===t.kind&&"SERVER"===a.kind){var n=!1,r=t.timestamp,i=a.timestamp;if(r&&i&&!(i>r)){var s=t.duration,c=a.duration;s&&c||(n=!0);var o=a.localEndpoint;if(o){var l=t.localEndpoint;if(l&&!ht(o,l)){if(n){var u=i-r;if(u>0)return;return new dt({endpoint:o,skew:u-1})}if(s<c)return new dt({endpoint:o,skew:i-r-1});var d=(s-c)/2;if(!(d<0)){var h=i-d-r;return 0!==h?new dt({endpoint:o,skew:h}):void 0}}}}}}(e);a?e.setSpan(mt(e.span,a)):t&&(a=t),e.children.forEach(function(e){return pt(e,a)})}function vt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0===e.length)return new ct;var a=new ut({debug:t}).build(e);if(!a.span)return t&&console.log("skipping clock skew adjustment due to missing root span: traceId=".concat(e[0].traceId)),a;for(var n=a.children,r=0;r<n.length;r+=1){var i=n[r].span;if(!i.parentId&&!i.shared){var s=i.traceId,c=i.id,o=a.span.id;if(t){console.log("".concat("skipping redundant root span",": traceId=").concat(s,", rootSpanId=").concat(o,", spanId=").concat(c))}return a}}return pt(a),a}var ft={};function bt(e,t){return"critical"===t?t:void 0!==e.tags.error?"critical":-1!==e.annotations.findIndex(function(e){return"error"===e.value})?"transient":t}function gt(e){if(e){var t=e.ipv4,a=e.ipv6,n=e.port,r=e.serviceName;return t||a?(a?"[".concat(a,"]"):t)+(n?":".concat(n):"")+(r?" (".concat(r,")"):""):r||""}}function Et(e,t){var a={isDerived:arguments.length>2&&void 0!==arguments[2]&&arguments[2],value:ft[e.value]||e.value,timestamp:e.timestamp};return t&&(a.endpoint=t),a}function Ct(e,t){t&&-1===e.findIndex(function(e){return e===t})&&e.push(t)}function yt(e){return e?e.serviceName:void 0}function kt(e,t){var a,n,r={spanId:Object(Ne.a)(e,1)[0].id,serviceNames:[],annotations:[],tags:[],errorType:"none"};return e.forEach(function(e){e.parentId&&(r.parentId=e.parentId),!e.name||r.spanName&&"SERVER"!==e.kind||(r.spanName=e.name),e.shared?(a||(a=e.timestamp),n||(n=e.duration)):(!r.timestamp&&e.timestamp&&(r.timestamp=e.timestamp),!r.duration&&e.duration&&(r.duration=e.duration));var i=yt(e.localEndpoint),s=yt(e.remoteEndpoint);i&&"SERVER"===e.kind?r.serviceName=i:t&&s&&"CLIENT"===e.kind&&!r.serviceName?r.serviceName=s:i&&!r.serviceName&&(r.serviceName=i),Ct(r.serviceNames,i),Ct(r.serviceNames,s),function(e){var t,a,n=gt(e.localEndpoint)||void 0,r=e.timestamp||0,i=r&&e.duration?r+e.duration:0,s=0,c=0,o=0,l=0,u=e.kind,d=[];switch(e.annotations.forEach(function(e){switch(e.value){case"cs":u="CLIENT",e.timestamp<=r?r=e.timestamp:d.push(e);break;case"sr":u="SERVER",e.timestamp<=r?r=e.timestamp:d.push(e);break;case"ss":u="SERVER",e.timestamp>=i?i=e.timestamp:d.push(e);break;case"cr":u="CLIENT",e.timestamp>=i?i=e.timestamp:d.push(e);break;case"ms":u="PRODUCER",s=e.timestamp;break;case"mr":u="CONSUMER",l=e.timestamp;break;case"ws":c=e.timestamp;break;case"wr":o=e.timestamp;break;default:d.push(e)}}),u){case"CLIENT":t="Client Start",a="Client Finish";break;case"SERVER":t="Server Start",a="Server Finish";break;case"PRODUCER":t="Producer Start",a="Producer Finish",(0===r||0!==s&&s<r)&&(r=s,s=0),(0===i||0!==c&&c>i)&&(i=c,c=0);break;case"CONSUMER":(0===r||0!==o&&o<r)&&(r=o,o=0),(0===i||0!==l&&l>i)&&(i=l,l=0),0!==i||0!==o?(t="Consumer Start",a="Consumer Finish"):t="Consumer Start"}s&&d.push({timestamp:s,value:"ms"}),c&&d.push({timestamp:c,value:"ws"}),o&&d.push({timestamp:o,value:"wr"}),l&&d.push({timestamp:l,value:"mr"});var h=r&&t,m=i&&a,p=[];return h&&p.push(Et({value:t,timestamp:r},n,!0)),d.forEach(function(e){h&&e.value===t||m&&e.value===a||p.push(Et(e,n))}),m&&p.push(Et({value:a,timestamp:i},n,!0)),p}(e).forEach(function(e){return function(e,t){-1===e.findIndex(function(e){return t.timestamp===e.timestamp&&t.value===e.value})&&e.push(t)}(r.annotations,e)}),function(e){var t,a=gt(e.localEndpoint)||void 0,n=[],r=Object.keys(e.tags);switch(r.length>0&&r.forEach(function(t){var r={key:ft[t]||t,value:e.tags[t]};a&&(r.endpoints=[a]),n.push(r)}),!e.kind&&0===e.annotations.length&&a&&0===r.length&&n.push({key:"Local Address",value:a}),e.kind){case"CLIENT":t="Server Address";break;case"SERVER":t="Client Address";break;case"PRODUCER":case"CONSUMER":t="Broker Address"}return e.remoteEndpoint&&n.push({key:t||"Server Address",value:gt(e.remoteEndpoint)}),n}(e).forEach(function(e){return function(e,t){var a=e.filter(function(e){return t.key===e.key&&t.value===e.value});0!==a.length?0!==(t.endpoints||[]).length&&a.forEach(function(e){e.endpoints||(e.endpoints=[]),t.endpoints.forEach(function(t){-1===e.endpoints.indexOf(t)&&e.endpoints.push(t)})}):e.push(t)}(r.tags,e)}),r.errorType=bt(e,r.errorType),e.debug&&(r.debug=!0)}),!r.timestamp&&a&&(r.timestamp=a),!r.duration&&n&&(r.duration=n),r.serviceNames.sort(),r.annotations.sort(function(e,t){return e.timestamp-t.timestamp}),r}function Ot(e,t){e.timestamp&&(t.push(e.timestamp),e.duration&&t.push(e.timestamp+e.duration))}function _t(e){return e.length>1?(e.sort(),e[e.length-1]-e[0]):0}function Nt(e,t,a){e[t]?e[t].push(a):e[t]=[a]}function St(e,t){return tt(e.span.timestamp,t.span.timestamp)}function Tt(e){var t,a=[],n={},r=0,i="none";if(e.traverse(function(e){r+=1,t=e.traceId,i=bt(e,i),Ot(e,a),function(e,t){var a={timestamp:e.timestamp||0,duration:e.duration||0};e.localEndpoint&&e.localEndpoint.serviceName&&Nt(t,e.localEndpoint.serviceName,a),e.remoteEndpoint&&e.remoteEndpoint.serviceName&&Nt(t,e.remoteEndpoint.serviceName,a)}(e,n)}),0===a.length)throw new Error("Trace ".concat(t," is missing a timestamp"));return{traceId:t,timestamp:a[0],duration:_t(a),groupedTimestamps:n,errorType:i,spanCount:r}}function jt(e,t){var a=k()(e/1e3);return t&&(a=a.utc()),a.format("MM-DD-YYYYTHH:mm:ss.SSSZZ")}function wt(e){return 0===e||"undefined"===typeof e?"":e<1e3?"".concat(e.toFixed(0),"\u03bcs"):e<1e6?"".concat((e/1e3).toFixed(e%1e3===0?0:3),"ms"):"".concat((e/1e6).toFixed(3),"s")}function Ft(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=Math.max.apply(Math,Object(X.a)(t.map(function(e){return e.duration})));return t.map(function(t){var r,i=t.timestamp,s={traceId:t.traceId,timestamp:i,startTs:jt(i,a),spanCount:t.spanCount},c=t.duration||0;if(c&&(s.width=parseInt(parseFloat(c)/parseFloat(n)*100,10),s.duration=c/1e3,s.durationStr=wt(c)),0!==Object.keys(t.groupedTimestamps).length&&(s.serviceSummaries=(r=t.groupedTimestamps,Je()(r).toPairs().map(function(e){var t=Object(Ne.a)(e,2),a=t[0],n=t[1];return{serviceName:a,spanCount:n.length,maxSpanDuration:Math.max.apply(Math,Object(X.a)(n.map(function(e){return e.duration})))}}).orderBy(["maxSpanDuration","serviceName"],["desc","asc"]).map(function(e){return{serviceName:e.serviceName,spanCount:e.spanCount,maxSpanDurationStr:wt(e.maxSpanDuration)}}).value()),e&&c&&t.groupedTimestamps[e])){var o=function(e){var t=Je()(e).filter(function(e){return e.duration}).sortBy("timestamp").value();if(0===t.length)return 0;if(1===t.length)return t[0].duration;for(var a=t[0].duration,n=t[0].timestamp+t[0].duration,r=1;r<t.length;r+=1){var i=t[r],s=i.timestamp+i.duration;s<=n||(i.timestamp<=n?(a+=s-n,n=s):(a+=i.duration,n=s))}return a}(t.groupedTimestamps[e]);s.servicePercentage=parseInt(parseFloat(o)/parseFloat(c)*100,10)}return"none"!==t.errorType&&(s.infoClass="trace-error-".concat(t.errorType)),s}).sort(function(e,t){var a=t.duration-e.duration;return 0===a?e.traceId.localeCompare(t.traceId):a})}function Rt(e,t){var a={},n=e.queueRootMostSpans(),r={traceId:n[0].span.traceId,depth:0,spans:[]},i=function(e){var t=[];return e.traverse(function(e){return Ot(e,t)}),{timestamp:t[0]||0,duration:_t(t)}}(e),s=i.timestamp,c=i.duration;if(!s)throw new Error("Trace ".concat(r.traceId," is missing a timestamp"));for(var o=function(){var e=n.shift(),t=[e.span],i=[];e.children.forEach(function(a){e.span.id===a.span.id?(t.push(a.span),a.children.forEach(function(e){return i.push(e)})):i.push(a)}),i.sort(St),n=i.concat(n);for(var o=i.map(function(e){return e.span.id}),l=1;e.parent&&e.parent.span;)e.parent.span.id!==e.span.id&&(l+=1),e=e.parent;l>r.depth&&(r.depth=l);var u=0===i.length,d=kt(t,u);!function(e,t,a,n,r){if(e.childIds=r,e.depth=n+1,e.depthClass=(n-1)%6,e.duration){var i=a?e.duration/a*100:0;e.width=i<.1?.1:i,e.durationStr=wt(e.duration)}else e.width=.1;a?(e.left=(e.timestamp-t)/a*100,e.annotations.forEach(function(a){a.left=e.duration?(a.timestamp-e.timestamp)/e.duration*100:0,a.relativeTime=wt(a.timestamp-t),a.width=8})):e.left=0}(d,s,c,l,o),d.serviceNames.forEach(function(e){var t,n;(t=a)[n=e]?t[n]+=1:t[n]=1}),r.spans.push(d)};n.length>0;)o();return r.serviceNameAndSpanCounts=Object.keys(a).sort().map(function(e){return{serviceName:e,spanCount:a[e]}}),r.spansBackup=r.spans,r.timeMarkers=[0,.2,.4,.6,.8,1].map(function(e,t){return{index:t,time:wt(c*e)}}),r.timeMarkersBackup=r.timeMarkers,r.duration=c,c&&(r.durationStr=wt(c)),t&&(r.logsUrl=t),r}ft.cs="Client Send",ft.csf="Client Send Fragment",ft.cr="Client Receive",ft.crf="Client Receive Fragment",ft.ms="Producer Send",ft.mr="Consumer Receive",ft.ss="Server Send",ft.ssf="Server Send Fragment",ft.sr="Server Receive",ft.srf="Server Receive Fragment",ft.ca="Client Address",ft.ma="Broker Address",ft.sa="Server Address",ft.ws="Wire Send",ft.wr="Wire Receive",ft.lc="Local Component";var Lt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={isTimelineOpened:!1},a.handleTimelineOpenToggle=a.handleTimelineOpenToggle.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleTimelineOpenToggle",value:function(){var e=this.state.isTimelineOpened;this.setState({isTimelineOpened:!e})}},{key:"barColor",value:function(){switch(this.props.traceSummary.infoClass){case"trace-error-transient":return Fe("transient");case"trace-error-critical":return Fe("critical");default:return Fe("none")}}},{key:"renderBar",value:function(e,t){return r.a.createElement("div",{className:"trace-summary__bar-container",role:"presentation",onClick:this.handleTimelineOpenToggle},r.a.createElement("div",{className:"trace-summary__bar-wrapper",style:{width:"".concat(e,"%")}},r.a.createElement("div",{className:"trace-summary__bar",style:{backgroundColor:this.barColor()}})),r.a.createElement("div",{className:"trace-summary__bar-label"},t))}},{key:"renderButtons",value:function(){var e=this.props.traceSummary,t=this.state.isTimelineOpened;return r.a.createElement("div",{className:"trace-summary__buttons"},r.a.createElement("span",{className:"fas fa-angle-double-".concat(t?"up":"down"," trace-summary__button"),role:"presentation",onClick:this.handleTimelineOpenToggle}),r.a.createElement("a",{href:"".concat(me,"/").concat(e.traceId),target:"_brank"},r.a.createElement("i",{className:"fas fa-file-download"})),r.a.createElement(f.a,{to:{pathname:"/zipkin/traces/".concat(e.traceId)}},r.a.createElement("i",{className:"fas fa-angle-double-right"})))}},{key:"renderServiceBadges",value:function(){return this.props.traceSummary.serviceSummaries.map(function(e){return r.a.createElement("div",{key:e.serviceName,className:"trace-summary__badge-wrapper"},r.a.createElement(Ie,{serviceName:e.serviceName,count:e.spanCount}))})}},{key:"renderTimeline",value:function(){var e=this.props.skewCorrectedTrace;if(!this.state.isTimelineOpened)return null;var t=Rt(e);return r.a.createElement("div",{className:"trace-summary__timeline-wrapper"},r.a.createElement(Ye,{startTs:0,endTs:t.duration,traceSummary:t}))}},{key:"render",value:function(){var e=this.props.traceSummary,t=r.a.createElement("div",{className:"trace-summary__upper-bar-label"},r.a.createElement("div",null,"".concat(e.spanCount,"spans ").concat(e.durationStr)),r.a.createElement("div",null,k()(e.timestamp/1e3).format("MM/DD HH:mm:ss:SSS"))),a="".concat(e.servicePercentage,"%");return r.a.createElement("div",{className:"trace-summary"},r.a.createElement("div",{className:"trace-summary__trace-id"},"Trace ID:\xa0",r.a.createElement("b",null,e.traceId)),r.a.createElement("div",{className:"trace-summary__upper-container"},r.a.createElement("div",{className:"trace-summary__bars"},this.renderBar(e.width,t),e.servicePercentage?this.renderBar(e.servicePercentage,a):null),this.renderButtons()),r.a.createElement("div",{className:"trace-summary__lower-container"},this.renderServiceBadges()),this.renderTimeline())}}]),t}(r.a.Component),It=a(98),xt=function(e){var t=e.active;return r.a.createElement("div",null,r.a.createElement(It.CSSTransition,{in:t,className:"loading-overlay",classNames:"loading-overlay",timeout:100,mountOnEnter:!0,unmountOnExit:!0},r.a.createElement("div",null,t?r.a.createElement("i",{className:"fa fa-spinner fa-spin loading-overlay-icon"}):null)))},Dt=[{value:"LONGEST",label:"Longest First"},{value:"SHORTEST",label:"Shortest First"},{value:"NEWEST",label:"Newest First"},{value:"OLDEST",label:"Oldest First"}],At=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={sortingMethod:"LONGEST"},a.handleSortingMethodChange=a.handleSortingMethodChange.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillUnmount",value:function(){(0,this.props.clearTraces)()}},{key:"handleSortingMethodChange",value:function(e){this.setState({sortingMethod:e.value})}},{key:"sortTraceSummaries",value:function(){var e=this.props.traceSummaries,t=this.state.sortingMethod;return e.sort(function(e,a){switch(t){case"LONGEST":return a.duration-e.duration;case"SHORTEST":return e.duration-a.duration;case"NEWEST":return a.timestamp-e.timestamp;case"OLDEST":return e.timestamp-a.timestamp;default:return 0}})}},{key:"renderResultsHeader",value:function(){var e=this.props.traceSummaries,t=this.state.sortingMethod;return r.a.createElement("div",{className:"browser__results-header"},r.a.createElement("div",{className:"browser__total-results"},"".concat(e.length," results")),r.a.createElement("div",null,r.a.createElement(S.a,{onChange:this.handleSortingMethodChange,className:"browser__sorting-method-select",options:Dt,value:{value:t,label:Dt.find(function(e){return e.value===t}).label}})))}},{key:"renderResults",value:function(){var e=this.props.skewCorrectedTracesMap,t=this.sortTraceSummaries();return r.a.createElement("div",{className:"browser__results"},t.map(function(t){return r.a.createElement("div",{key:t.traceId,className:"browser__trace-summary-wrapper"},r.a.createElement(Lt,{traceSummary:t,skewCorrectedTrace:e[t.traceId]}))}))}},{key:"render",value:function(){var e=this.props.isLoading;return r.a.createElement("div",{className:"browser"},r.a.createElement(xt,{active:e}),this.renderResultsHeader(),this.renderResults())}}]),t}(r.a.Component),Mt=Object(h.b)(function(e,t){var a,n=t.location;""!==n.search&&"?"!==n.search&&(a=_.a.parse(n.search).serviceName);var r=e.traces.traces,i=r.map(vt),s=Ft(a,i.map(Tt)),c={};return i.forEach(function(e,t){var a=Object(Ne.a)(r[t],1)[0].traceId;c[a]=e}),{traceSummaries:s,skewCorrectedTracesMap:c,isLoading:e.traces.isLoading}},function(e){return{clearTraces:function(){return e({type:"CLEAR_TRACES"})}}})(At),Bt=function(e){return{type:"FETCH_TRACE_SUCCESS",trace:e}},Ut=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={isDragging:!1,dragStartX:null,dragCurrentX:null},a._graphElement=void 0,a.setGraphElement=a.setGraphElement.bind(Object(C.a)(Object(C.a)(a))),a.handleMouseDown=a.handleMouseDown.bind(Object(C.a)(Object(C.a)(a))),a.handleMouseMove=a.handleMouseMove.bind(Object(C.a)(Object(C.a)(a))),a.handleMouseUp=a.handleMouseUp.bind(Object(C.a)(Object(C.a)(a))),a.handleDoubleClick=a.handleDoubleClick.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"setGraphElement",value:function(e){this._graphElement=e}},{key:"getPosition",value:function(e){var t=this._graphElement.getBoundingClientRect();return(e-t.left)/t.width}},{key:"handleMouseDown",value:function(e){if(0===e.button){var t=this.getPosition(e.clientX);this.setState({isDragging:!0,dragStartX:t,dragCurrentX:t}),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleMouseUp)}}},{key:"handleMouseMove",value:function(e){this.setState({dragCurrentX:this.getPosition(e.clientX)})}},{key:"handleMouseUp",value:function(e){var t,a,n=this.props,r=n.traceSummary,i=n.onStartAndEndTsChange,s=this.state.dragStartX;this.setState({isDragging:!1});var c=this.getPosition(e.clientX);c>s?(t=Math.max(s*r.duration,0),a=Math.min(c*r.duration,r.duration)):(t=Math.max(c*r.duration,0),a=Math.min(s*r.duration,r.duration)),i(t,a),window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseUp)}},{key:"handleDoubleClick",value:function(){var e=this.props,t=e.traceSummary;(0,e.onStartAndEndTsChange)(0,t.duration)}},{key:"renderTicks",value:function(){for(var e=this.props.traceSummary,t=[],a=0;a<5;a+=1){var n=Te(a/4*e.duration),i=a/4,s="";0===i?s="first":i>=1&&(s="last"),t.push(r.a.createElement("div",{key:i,className:"mini-trace-viewer__time-marker",style:{left:"".concat(100*i,"%")}},r.a.createElement("span",{className:"mini-trace-viewer__time-marker-label ".concat(s)},n)))}return r.a.createElement("div",null,t)}},{key:"render",value:function(){var e=this.props,t=e.traceSummary,a=e.startTs,n=e.endTs,i=this.state,s=i.isDragging,c=i.dragStartX,o=i.dragCurrentX,l=t.spans,u=75/l.length;return r.a.createElement("div",{className:"mini-trace-viewer"},r.a.createElement("div",{className:"mini-trace-viewer__time-markers-wrapper"},this.renderTicks()),r.a.createElement("div",{className:"mini-trace-viewer__graph",ref:this.setGraphElement,role:"presentation",onMouseDown:this.handleMouseDown,onDoubleClick:this.handleDoubleClick},r.a.createElement("svg",{version:"1.1",width:"100%",height:75,xmlns:"http://www.w3.org/2000/svg"},function(){for(var e=[],t=1;t<4;t+=1){var a=25*t;e.push(r.a.createElement("line",{key:a,x1:"".concat(a,"%"),x2:"".concat(a,"%"),y1:"0",y2:75}))}return r.a.createElement("g",{stroke:"#888",strokeWidth:"1"},e)}(),l.map(function(e,t){return r.a.createElement("rect",{key:e.spanId,width:"".concat(e.width,"%"),height:u,x:"".concat(e.left,"%"),y:t*u,fill:Re(e.serviceName)})}),s?r.a.createElement("g",{stroke:"#999",strokeWidth:"1"},r.a.createElement("line",{x1:"".concat(100*c,"%"),x2:"".concat(100*c,"%"),y1:0,y2:75}),r.a.createElement("line",{x1:"".concat(100*c,"%"),x2:"".concat(100*o,"%"),y1:37.5,y2:37.5}),r.a.createElement("line",{x1:"".concat(100*o,"%"),x2:"".concat(100*o,"%"),y1:0,y2:75})):null,a?r.a.createElement("rect",{width:"".concat(a/t.duration*100,"%"),height:75,x:"0",y:"0",fill:"rgba(50, 50, 50, 0.2)"}):null,n?r.a.createElement("rect",{width:"".concat((t.duration-n)/t.duration*100,"%"),height:75,x:"".concat(n/t.duration*100,"%"),y:"0",fill:"rgba(50, 50, 50, 0.2)"}):null)))}}]),t}(r.a.Component),Vt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={startTs:null,endTs:null},a.handleStartAndEndTsChange=a.handleStartAndEndTsChange.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.fetchTrace,a=e.traceId,n=e.traceSummary;n&&n.traceId===a||t(a)}},{key:"handleStartAndEndTsChange",value:function(e,t){this.setState({startTs:e,endTs:t})}},{key:"renderHeader",value:function(){var e=this.props,t=e.traceId,a=e.traceSummary,n=a.durationStr,i=a.serviceNameAndSpanCounts,s=a.spans,c=a.depth;return r.a.createElement("div",{className:"detailed-trace-summary__header"},r.a.createElement("div",{className:"detailed-trace-summary__trace-id"},t),r.a.createElement("div",{className:"detailed-trace-summary__trace-data-list"},[{label:"Duration",value:n},{label:"Services",value:i.length},{label:"Depth",value:c},{label:"Total Spans",value:s.length}].map(function(e){return r.a.createElement("div",{key:e.label,className:"detailed-trace-summary__data-wrapper"},r.a.createElement("div",{className:"detailed-trace-summary__data-label"},e.label),r.a.createElement("div",{className:"detailed-trace-summary__data-value"},e.value))})))}},{key:"render",value:function(){var e=this.state,t=e.startTs,a=e.endTs,n=this.props,i=n.isLoading,s=n.traceId,c=n.traceSummary;return r.a.createElement("div",null,r.a.createElement(xt,{active:i}),r.a.createElement("div",{className:"detailed-trace-summary"},c&&c.traceId===s?r.a.createElement("div",null,this.renderHeader(),r.a.createElement("div",{className:"detailed-trace-summary__mini-trace-viewer-wrapper"},r.a.createElement(Ut,{startTs:t||0,endTs:a||c.duration,traceSummary:c,onStartAndEndTsChange:this.handleStartAndEndTsChange})),r.a.createElement("div",{className:"detailed-trace-summary__timeline-wrapper"},r.a.createElement(Ye,{startTs:t||0,endTs:a||c.duration,traceSummary:c}))):null))}}]),t}(r.a.Component);Vt.defaultProps={traceSummary:null};var Kt=Vt,Pt=Object(h.b)(function(e,t){var a={isLoading:e.trace.isLoading,traceId:t.match.params.traceId};if(0===e.trace.trace.length)a.traceSummary=null;else{var n=vt(e.trace.trace);a.traceSummary=Rt(n)}return a},function(e){return{fetchTrace:function(t){return e(function(e){return function(){var t=Object(ce.a)(se.a.mark(function t(a){var n,r;return se.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a({type:"FETCH_TRACE_REQUEST"}),t.prev=1,t.next=4,Promise.all([fetch("".concat(me,"/").concat(e)),new Promise(function(e){return setTimeout(e,300)})]);case 4:if((n=t.sent)[0].ok){t.next=7;break}throw Error(n[0].statusText);case 7:return t.next=9,n[0].json();case 9:r=t.sent,a(Bt(r)),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),a({type:"FETCH_TRACE_FAILURE"});case 16:case"end":return t.stop()}},t,null,[[1,13]])}));return function(e){return t.apply(this,arguments)}}()}(t))}}})(Kt),Ht=a(287),Wt=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentWillUnmount",value:function(){this.vizceral.animate=function(){},delete this.vizceral}}]),t}(a.n(Ht).a),zt={selectedServiceName:void 0},qt={colorText:"rgb(50, 50, 50)",colorTextDisabled:"rgb(50, 50, 50)",colorConnectionLine:"rgb(50, 50, 50)",colorTraffic:{normal:"rgb(145, 200, 220)",warning:"rgb(255, 75, 75)",danger:"rgb(255, 75, 75)"},colorDonutInternalColor:"rgb(245, 245, 245)",colorDonutInternalColorHighlighted:"rgb(145, 200, 220)",colorLabelBorder:"rgb(85, 140, 160)",colorLabelText:"rgb(50, 50, 50)",colorTrafficHighlighted:{normal:"rgb(155, 210, 230)"}},Gt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleObjectHighlighted=a.handleObjectHighlighted.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleObjectHighlighted",value:function(e){var t=this.props,a=t.selectedServiceName,n=t.onServiceSelect;"undefined"!==typeof e?"node"===e.type&&e.getName()!==a&&n(e.getName()):n(void 0)}},{key:"render",value:function(){var e=this.props,t=e.graph,a=e.filter,n=0;if(t.allEdges().length>0){var i=Je.a.maxBy(t.allEdges(),function(e){return e.metrics.normal+e.metrics.danger});n=i.metrics.normal+i.metrics.danger}return r.a.createElement("div",{className:"dependencies__graph"},r.a.createElement(Wt,{allowDraggingOfNodes:!0,targetFramerate:15,traffic:{renderer:"region",layout:"ltrTree",name:"dependencies-graph",updated:(new Date).getTime(),maxVolume:2e3*n,nodes:t.allNodes(),connections:t.allEdges()},objectHighlighted:this.handleObjectHighlighted,match:a,styles:qt}))}}]),t}(r.a.Component);Gt.defaultProps=zt;var Qt=Gt,Yt=a(288),Xt=function(e,t){if(0===e.length)return r.a.createElement("div",{className:"dependencies-sidebar__no-edges"},r.a.createElement("span",{className:"fas fa-exclamation-circle dependencies-sidebar__no-edges-icon"}),"No services");var a=t?"target":"source";return e.map(function(e){return r.a.createElement("div",{className:"dependencies-sidebar__edge-data"},r.a.createElement(Ie,{serviceName:e[a]}),r.a.createElement("div",{className:"dependencies-sidebar__count-data-wrapper"},r.a.createElement("div",{className:"dependencies-sidebar__count-data"},r.a.createElement("div",{className:"dependencies-sidebar__count-data-label dependencies-sidebar__count-data-label--normal"},"COUNT"),r.a.createElement("div",{className:"dependencies-sidebar__count-data-value"},e.metrics.normal)),r.a.createElement("div",{className:"dependencies-sidebar__count-data"},r.a.createElement("div",{className:"dependencies-sidebar__count-data-label dependencies-sidebar__count-data-label--danger"},"ERROR"),r.a.createElement("div",{className:"dependencies-sidebar__count-data-value"},e.metrics.danger))))})},Jt=function(e,t){if(0===e.length)return null;var a={maintainAspectRatio:!1,responsive:!1,labels:t?e.map(function(e){return e.target}):e.map(function(e){return e.source}),datasets:[{data:e.map(function(e){return e.metrics.normal+e.metrics.danger}),backgroundColor:t?e.map(function(e){return Re(e.target)}):e.map(function(e){return Re(e.source)})}]};return r.a.createElement("div",{className:"dependencies-sidebar__doughnut"},r.a.createElement(Yt.a,{data:a,width:420,height:540}))},Zt=function(e){var t=e.serviceName,a=e.targetEdges,n=e.sourceEdges;return r.a.createElement("div",{className:"dependencies-sidebar"},r.a.createElement("div",{className:"dependencies-sidebar__service-name-container"},r.a.createElement("div",{className:"dependencies-sidebar__service-name"},t)),r.a.createElement("div",{className:"dependencies-sidebar__subtitle"},r.a.createElement("span",{className:"fas fa-angle-double-down dependencies-sidebar__subtitle-icon"}),r.a.createElement("strong",null,"Uses"),"(Traced requests)"),Xt(a,!0),r.a.createElement("div",{className:"dependencies-sidebar__doughnut-wrapper"},Jt(a,!0)),r.a.createElement("div",{className:"dependencies-sidebar__separator"}),r.a.createElement("div",{className:"dependencies-sidebar__subtitle"},r.a.createElement("span",{className:"fas fa-angle-double-up dependencies-sidebar__subtitle-icon"}),r.a.createElement("strong",null,"Used by"),"(Traced requests)"),Xt(n,!1),r.a.createElement("div",{className:"dependencies-sidebar__doughnut-wrapper"},Jt(n,!1)))},$t=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={startTs:k()().subtract(1,"days"),endTs:k()(),selectedServiceName:"",filter:""},a.handleStartTsChange=a.handleStartTsChange.bind(Object(C.a)(Object(C.a)(a))),a.handleEndTsChange=a.handleEndTsChange.bind(Object(C.a)(Object(C.a)(a))),a.handleServiceSelect=a.handleServiceSelect.bind(Object(C.a)(Object(C.a)(a))),a.handleFilterChange=a.handleFilterChange.bind(Object(C.a)(Object(C.a)(a))),a.handleAnalyzeButtonClick=a.handleAnalyzeButtonClick.bind(Object(C.a)(Object(C.a)(a))),a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.location,a=e.fetchDependencies,n=_.a.parse(t.search),r=n.endTs?k()(parseInt(n.endTs,10)):k()(),i=n.lookback?k.a.duration(parseInt(n.lookback,10)):k.a.duration(1,"days"),s=r.clone().subtract(i);(this.setState({startTs:s,endTs:r}),""!==t.search&&"?"!==t.search)&&a(_.a.parse(t.search))}},{key:"componentWillReceiveProps",value:function(e){var t=e.location,a=this.props,n=a.location,r=a.fetchDependencies;""!==t.search&&"?"!==t.search&&n.search!==t.search&&r(_.a.parse(t.search))}},{key:"componentWillUnmount",value:function(){(0,this.props.clearDependencies)()}},{key:"handleStartTsChange",value:function(e){this.setState({startTs:e})}},{key:"handleEndTsChange",value:function(e){this.setState({endTs:e})}},{key:"handleServiceSelect",value:function(e){this.setState({selectedServiceName:e})}},{key:"handleFilterChange",value:function(e){this.setState({filter:e})}},{key:"handleAnalyzeButtonClick",value:function(){var e=this.state,t=e.startTs,a=e.endTs,n=this.props.history,r=J({endTs:a.valueOf(),lookback:a.valueOf()-t.valueOf()});n.push({pathname:"/zipkin/dependency",search:r})}},{key:"renderSearch",value:function(){var e=this.state,t=e.startTs,a=e.endTs;return r.a.createElement("div",{className:"dependencies__search"},r.a.createElement("div",{className:"dependencies__lookback-condition"},r.a.createElement(G,{onChange:this.handleStartTsChange,selected:t})),r.a.createElement("div",{className:"dependencies__lookback-condition-separator"},"-"),r.a.createElement("div",{className:"dependencies__lookback-condition"},r.a.createElement(G,{onChange:this.handleEndTsChange,selected:a})),r.a.createElement("div",{className:"dependencies__analyze-button-wrapper"},r.a.createElement("div",{role:"presentation",onClick:this.handleAnalyzeButtonClick,className:"dependencies__analyze-button"},"Analyze Dependencies")))}},{key:"renderFilter",value:function(){var e=this,t=this.state.filter,a=this.props.graph.allNodeNames().map(function(e){return{value:e,label:e}}),n=t?{value:t,label:t}:void 0;return r.a.createElement(S.a,{onChange:function(t){e.handleFilterChange(t.value)},options:a,value:n,styles:{control:function(e){return Object(N.a)({},e,{width:"240px"})}},placeholder:"Filter by ..."})}},{key:"render",value:function(){var e=this.props,t=e.isLoading,a=e.graph,n=this.state,i=n.selectedServiceName,s=n.filter,c=!!i;return r.a.createElement("div",{className:"dependencies"},r.a.createElement(xt,{active:t}),r.a.createElement("div",{className:"dependencies__main ".concat(c?"dependencies__main--narrow":"dependencies__main--wide")},r.a.createElement("div",{className:"dependencies__search-wrapper"},this.renderSearch()),0===a.allNodes().length?null:r.a.createElement("div",null,r.a.createElement("div",{className:"dependencies__filter-wrapper"},this.renderFilter()),r.a.createElement("div",{className:"dependencies__graph-wrapper"},r.a.createElement(Qt,{graph:a,onServiceSelect:this.handleServiceSelect,selectedServiceName:i,filter:s})))),r.a.createElement("div",{className:"dependencies__sidebar-wrapper ".concat(c?"dependencies__sidebar-wrapper--opened":"dependencies__sidebar-wrapper--closed")},r.a.createElement(Zt,{serviceName:i,targetEdges:a.getTargetEdges(i),sourceEdges:a.getSourceEdges(i)})))}}]),t}(r.a.Component),ea=Object(v.a)($t),ta=function(e){return{type:"FETCH_DEPENDENCIES_SUCCESS",dependencies:e}},aa=function(){function e(t){var a=this;Object(c.a)(this,e),this.nodes=[],this.edges=[],t.forEach(function(e){return a.addEdge(e)})}return Object(o.a)(e,[{key:"addEdge",value:function(e){this.allNodeNames().includes(e.parent)||this.nodes.push({name:e.parent}),this.allNodeNames().includes(e.child)||this.nodes.push({name:e.child}),this.edges.push({source:e.parent,target:e.child,metrics:{normal:e.callCount||0,danger:e.errorCount||0}})}},{key:"allNodeNames",value:function(){return this.nodes.map(function(e){return e.name})}},{key:"allNodes",value:function(){return this.nodes}},{key:"allEdges",value:function(){return this.edges}},{key:"getTargetEdges",value:function(e){return this.allEdges().filter(function(t){return t.source===e})}},{key:"getSourceEdges",value:function(e){return this.allEdges().filter(function(t){return t.target===e})}}]),e}(),na=Object(h.b)(function(e){return{isLoading:e.dependencies.isLoading,graph:new aa(e.dependencies.dependencies)}},function(e){return{fetchDependencies:function(t){return e(function(e){return function(){var t=Object(ce.a)(se.a.mark(function t(a){var n,r,i;return se.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a({type:"FETCH_DEPENDENCIES_REQUEST"}),t.prev=1,n=_.a.stringify(e),t.next=5,Promise.all([fetch("".concat(pe,"?").concat(n)),new Promise(function(e){return setTimeout(e,500)})]);case 5:if((r=t.sent)[0].ok){t.next=8;break}throw Error(r[0].statusText);case 8:return t.next=10,r[0].json();case 10:i=t.sent,a(ta(i)),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),a({type:"FETCH_DEPENDENCIES_FAILURE"});case 17:case"end":return t.stop()}},t,null,[[1,14]])}));return function(e){return t.apply(this,arguments)}}()}(t))},clearDependencies:function(){return e({type:"CLEAR_DEPENDENCIES"})}}})(ea),ra=a(87),ia=a(290),sa={isLoading:!1,spans:[]},ca=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_SPANS_REQUEST":return Object(N.a)({},e,{isLoading:!0,spans:[]});case"FETCH_SPANS_SUCCESS":return Object(N.a)({},e,{isLoading:!1,spans:t.spans});case"FETCH_SPANS_FAILURE":return Object(N.a)({},e,{isLoading:!1,spans:[]});case"CLEAR_SPANS":return Object(N.a)({},e,{spans:[]});default:return e}},oa={isLoading:!1,trace:[]},la=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_TRACE_REQUEST":return Object(N.a)({},e,{isLoading:!0,trace:[]});case"FETCH_TRACE_SUCCESS":return Object(N.a)({},e,{isLoading:!1,trace:t.trace});case"FETCH_TRACE_FAILURE":return Object(N.a)({},e,{isLoading:!1,trace:[]});default:return e}},ua={isLoading:!1,traces:[]},da=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ua,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_TRACES_REQUEST":return Object(N.a)({},e,{isLoading:!0});case"FETCH_TRACES_SUCCESS":return Object(N.a)({},e,{isLoading:!1,traces:t.traces});case"FETCH_TRACES_FAILURE":return Object(N.a)({},e,{isLoading:!1,traces:[]});case"CLEAR_TRACES":return Object(N.a)({},e,{traces:[]});default:return e}},ha={isLoading:!1,services:[]},ma=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ha,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_SERVICES_REQUEST":return Object(N.a)({},e,{isLoading:!0,services:[]});case"FETCH_SERVICES_SUCCESS":return Object(N.a)({},e,{isLoading:!1,services:t.services});case"FETCH_SERVICES_FAILURE":return Object(N.a)({},e,{isLoading:!1,services:[]});default:return e}},pa={isLoading:!1,dependencies:[]},va=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_DEPENDENCIES_REQUEST":return Object(N.a)({},e,{isLoading:!0});case"FETCH_DEPENDENCIES_SUCCESS":return Object(N.a)({},e,{isLoading:!1,dependencies:t.dependencies});case"FETCH_DEPENDENCIES_FAILURE":return Object(N.a)({},e,{isLoading:!1,dependencies:[]});case"CLEAR_DEPENDENCIES":return Object(N.a)({},e,{dependencies:[]});default:return e}},fa=a(291),ba=a.n(fa),ga={conditions:[],lookbackCondition:{value:"1h",endTs:k()().valueOf()},limitCondition:10},Ea=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ga,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GLOBAL_SEARCH_SET_LOOKBACK_CONDITION":return Object(N.a)({},e,{lookbackCondition:t.lookbackCondition});case"GLOBAL_SEARCH_SET_LIMIT_CONDITION":return Object(N.a)({},e,{limitCondition:t.limitCondition});case"GLOBAL_SEARCH_ADD_CONDITION":var a={key:t.condition.key,value:t.condition.value,_id:ba.a.generate()};return Object(N.a)({},e,{conditions:[].concat(Object(X.a)(e.conditions),[a])});case"GLOBAL_SEARCH_DELETE_CONDITION":var n=Object(X.a)(e.conditions);return n.splice(t.index,1),Object(N.a)({},e,{conditions:n});case"GLOBAL_SEARCH_CHANGE_CONDITION_KEY":var r=Object(X.a)(e.conditions),i=Object(N.a)({},r[t.index]);return i.key=t.conditionKey,i.value=te(t.conditionKey),r[t.index]=i,Object(N.a)({},e,{conditions:r});case"GLOBAL_SEARCH_CHANGE_CONDITION_VALUE":var s=Object(X.a)(e.conditions),c=Object(N.a)({},s[t.index]);return c.value=t.conditionValue,s[t.index]=c,Object(N.a)({},e,{conditions:s});default:return e}},Ca={isLoading:!1,autocompleteKeys:[]},ya=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ca,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_AUTOCOMPLETE_KEYS_REQUEST":return Object(N.a)({},e,{isLoading:!0});case"FETCH_AUTOCOMPLETE_KEYS_SUCCESS":return Object(N.a)({},e,{isLoading:!1,autocompleteKeys:t.autocompleteKeys});case"FETCH_AUTOCOMPLETE_KEYS_FAILURE":return Object(N.a)({},e,{isLoading:!1,autocompleteKeys:[]});default:return e}},ka={isLoading:!1,autocompleteValues:[]},Oa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ka,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_AUTOCOMPLETE_VALUES_REQUEST":return Object(N.a)({},e,{isLoading:!0});case"FETCH_AUTOCOMPLETE_VALUES_SUCCESS":return Object(N.a)({},e,{isLoading:!1,autocompleteValues:t.autocompleteValues});case"FETCH_AUTOCOMPLETE_VALUES_FAILURE":return Object(N.a)({},e,{isLoading:!1,autocompleteValues:[]});default:return e}},_a=Object(ra.c)({spans:ca,trace:la,traces:da,services:ma,dependencies:va,globalSearch:Ea,autocompleteKeys:ya,autocompleteValues:Oa});var Na=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){document.title="Zipkin"}},{key:"render",value:function(){return r.a.createElement(h.a,{store:Object(ra.d)(_a,Object(ra.a)(ia.a))},r.a.createElement(m.a,null,r.a.createElement(_e,null,r.a.createElement(p.a,{exact:!0,path:"/zipkin",render:function(e){return r.a.createElement(Mt,e)}}),r.a.createElement(p.a,{exact:!0,path:"/zipkin/traces/:traceId",render:function(e){return r.a.createElement(Pt,e)}}),r.a.createElement(p.a,{exact:!0,path:"/zipkin/dependency",render:function(e){return r.a.createElement(na,e)}}))))}}]),t}(r.a.Component);a(511);a(512),s.a.render(r.a.createElement(Na,null),document.getElementById("app"))}},[[295,1,2]]]);
//# sourceMappingURL=main.cf39bf5f.chunk.js.map